<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://beginljm.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/blog/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://beginljm.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Android 多进程 IPC" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/08/13/Android 多进程 IPC/" class="article-date">
  <time datetime="2016-08-13T02:16:15.000Z" itemprop="datePublished">2016-08-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/08/13/Android 多进程 IPC/">Android 多进程通信 IPC</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Android-多进程通信-（IPC）"><a href="#Android-多进程通信-（IPC）" class="headerlink" title="Android 多进程通信 （IPC）"></a>Android 多进程通信 （IPC）</h1><h2 id="开启多进程"><a href="#开启多进程" class="headerlink" title="开启多进程"></a>开启多进程</h2><p>在四大组件（Activity，Service，Receiver，ContentProvider）中指定 android:process 属性</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">activity</span></span></div><div class="line">	<span class="attr">android:name</span>=<span class="string">".activity.TwoActivity"</span></div><div class="line">	<span class="attr">android:configChanges</span>=<span class="string">"screenLayout"</span></div><div class="line">	<span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">	<span class="attr">android:process</span>=<span class="string">":remote"</span> /&gt;</div></pre></td></tr></table></figure>
<p> <img src="content/images/2016/08/屏幕快照 2016-08-10 10.57.49.png" alt=""></p>
<p>多进程可能造成的问题</p>
<ol>
<li>静态成员和单例模式完全失效（系统为每个进程都创建了一个虚拟机）</li>
<li>线程同步机制完全失效（同上）</li>
<li>SharedPreferences 的可靠性下降（SharedPreferences 不支持两个进程同时进行写操作.否则会造成数据丢失）</li>
<li>Application 会多次创建（同1）</li>
</ol>
<h2 id="多进程间通信的基础"><a href="#多进程间通信的基础" class="headerlink" title="多进程间通信的基础"></a>多进程间通信的基础</h2><h3 id="序列化对象"><a href="#序列化对象" class="headerlink" title="序列化对象"></a>序列化对象</h3><h4 id="Serializable-推荐用于文件存储"><a href="#Serializable-推荐用于文件存储" class="headerlink" title="Serializable(推荐用于文件存储)"></a>Serializable(推荐用于文件存储)</h4><p>需要被序列号的实现 Serializable 接口就可进行序列化和反序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserManager</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">123321798231L</span>;<span class="comment">//一个任意值.可不不指定.但建议指定.用户校验反序列号的对象是否为该对象</span></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> userId = <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>序列号与反序列号过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//序列号过程</span></div><div class="line">ObjectOutputStream outputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(getFileStreamPath(<span class="string">"cache.txt"</span>)));</div><div class="line">outputStream.writeObject(userManager);</div><div class="line">outputStream.close();</div><div class="line"></div><div class="line"><span class="comment">//反序列化过程</span></div><div class="line">ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(getFileStreamPath(<span class="string">"cache.txt"</span>)));</div><div class="line">UserManager userManager = (UserManager) objectInputStream.readObject();</div><div class="line">objectInputStream.close();</div></pre></td></tr></table></figure>
<h4 id="Parcelable-推荐用于数据传送"><a href="#Parcelable-推荐用于数据传送" class="headerlink" title="Parcelable(推荐用于数据传送)"></a>Parcelable(推荐用于数据传送)</h4><p>与Serializable类似.同样是使需要被序列号的类实现Parcelable接口.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> userId;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> userId)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.userId = userId;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">User</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        userId = in.readInt();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;User&gt; CREATOR = <span class="keyword">new</span> Creator&lt;User&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> User[] newArray(<span class="keyword">int</span> size) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> User[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel parcel, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="comment">//在这里执行序列号过程</span></div><div class="line">        parcel.writeInt(userId);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>数据传送与获取过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">User userManager = <span class="keyword">new</span> User(<span class="number">3</span>);</div><div class="line">Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, ThreeActivity.class);</div><div class="line">intent.putExtra(<span class="string">"user"</span>, userManager);</div><div class="line">startActivity(intent);</div><div class="line"></div><div class="line">User userManager = getIntent().getParcelableExtra(<span class="string">"user"</span>);</div><div class="line">Log.d(<span class="string">"Three"</span>, userManager.userId + <span class="string">""</span>);</div></pre></td></tr></table></figure>
<h3 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h3><p>Binder 是 Android 中的一种跨进程的通信方式，主要用于 Service，包括AIDL和 Messenger。Messenger 的底层又是由 AIDL 实现.</p>
<h4 id="AIDL"><a href="#AIDL" class="headerlink" title="AIDL"></a>AIDL</h4><p>首先创建三个文件</p>
<p><strong>Book.java</strong> 简单的实体类.实现了 Parcelable 接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Parcel;</div><div class="line"><span class="keyword">import</span> android.os.Parcelable;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Begin on 16/8/10.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">Parcelable</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> bookId;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">(<span class="keyword">int</span> bookId)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.bookId = bookId;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">Book</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">        bookId = in.readInt();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Creator&lt;Book&gt; CREATOR = <span class="keyword">new</span> Creator&lt;Book&gt;() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> Book <span class="title">createFromParcel</span><span class="params">(Parcel in)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Book(in);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="keyword">public</span> Book[] newArray(<span class="keyword">int</span> size) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Book[size];</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">describeContents</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeToParcel</span><span class="params">(Parcel parcel, <span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        parcel.writeInt(bookId);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>Book.aidl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.lu.ipc.aidl.Book;</div><div class="line"></div><div class="line">parcelable Book;</div></pre></td></tr></table></figure>
<p><strong>IBookManager.aidl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.lu.ipc.aidl.Book;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IBookManager</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">basicTypes</span><span class="params">(<span class="keyword">int</span> anInt, <span class="keyword">long</span> aLong, <span class="keyword">boolean</span> aBoolean, <span class="keyword">float</span> aFloat,</span></span></div><div class="line">            <span class="keyword">double</span> aDouble, String aString);</div><div class="line"></div><div class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBookList</span><span class="params">()</span></span>;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBook</span><span class="params">(in Book book)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这两个AIDL 文件是用于让系统自动生成 Binder 服务端代码.实现后的代码在./app/build/generated/source/aidl/debug/com/lu/ipc/aidl/目录下.</p>
<p>主要说下生成的类中的 getBookList 和 addBook 两个方法.这两个方法都是在当客户端调用该方法的时候创建一个输入型对象_data 和输出型对象_reply，如果有传入参数则将参数写入到_data 中,接着调用 transact 方法发起 RPC（远程过程调用）请求,这时候当前线程会被挂起.然后服务端的 onTransact 方法会被调用.直到 RPC 过程返回后,当前线程继续执行,并从_reply 中取出返回结果并 return.</p>
<p>附上 Binder 的工作机制图：</p>
<p> <img src="content/images/2016/08/屏幕快照 2016-08-11 09.32.10.png" alt="屏幕快照 2016-08-11 09.32.10"></p>
<h4 id="likeToDeath-和-unlikeToDeath"><a href="#likeToDeath-和-unlikeToDeath" class="headerlink" title="likeToDeath 和 unlikeToDeath"></a>likeToDeath 和 unlikeToDeath</h4><p>这两个是 Binder 中很重要的方法.主要用于服务端和客户端的链接被断开（服务端被杀死）</p>
<p>（没看懂书上说的啥玩意.设置代理.代理触发后回调…大概就这个意思吧…）</p>
<p>设置代理是绑定成功服务后通过<code>binder.linkToDeath(mDeathRecipient,0);</code>实现.</p>
<p>设置代理回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> DeathRecipient mDeathRecipient = <span class="keyword">new</span> DeathRecipient() &#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">binderDied</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mBookManager == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        mBookManager.asBinder().unlinkToDeath(mDeathRecipient, <span class="number">0</span>);</div><div class="line">        mBookManager = <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h2 id="Android-中的-IPC-方式"><a href="#Android-中的-IPC-方式" class="headerlink" title="Android 中的 IPC 方式"></a>Android 中的 IPC 方式</h2><p>Android 中的 IPC 方式有很多种.可以通过 Intent 中附加 extras 可以通过共享文件.还有 ContentProvider.以及网络通信.</p>
<h3 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h3><p>在 Activity Service Receiver 中都是支持再 Intent 中传递 Bundle 数据的.再 Bundle 中可以附加能够被序列号的对象进行通信</p>
<h3 id="通过文件共享"><a href="#通过文件共享" class="headerlink" title="通过文件共享"></a>通过文件共享</h3><p>没啥说的.读写同一个文件就是了.对象可以通过实现Serializable接口进行序列化</p>
<p>要注意的是不能使用 Sharedpreferences 文件进行共享…因为有缓存…</p>
<h3 id="Messenger"><a href="#Messenger" class="headerlink" title="Messenger"></a>Messenger</h3><p>本质就是AIDL.是AIDL 一个的一个简单封装.但是 Messenger 只能用来处理消息传送.如果需要调用服务端的方法.Messenger 就无能为力了.这时候就需要使用AIDL 来自己实现跨进程的方法调用.</p>
<p>首先定义 Service</p>
<p><strong>BookService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//用于接收和处理消息的 Handle</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">BookHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//当收到消息后</span></div><div class="line">                    Log.d(<span class="string">"BookService"</span>, <span class="string">"msg:"</span> + msg.getData().getString(<span class="string">"msg"</span>));<span class="comment">//获取消息内容并输出 log</span></div><div class="line">                    Messenger client = msg.replyTo;<span class="comment">//获取 reply</span></div><div class="line">                    Message replyMessage = Message.obtain(<span class="keyword">null</span>, <span class="number">1</span>);<span class="comment">//创建返回消息</span></div><div class="line">                    Bundle bundle = <span class="keyword">new</span> Bundle();</div><div class="line">                    bundle.putString(<span class="string">"reply"</span>, <span class="string">"world"</span>);<span class="comment">//创建 Bundle 并添加内容</span></div><div class="line">                    replyMessage.setData(bundle);<span class="comment">//为返回消息添加 Bundle 内容</span></div><div class="line">                    <span class="keyword">try</span> &#123;</div><div class="line">                        client.send(replyMessage);<span class="comment">//发送返回消息</span></div><div class="line">                    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                        e.printStackTrace();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">super</span>.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Messenger mMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> BookHandler());<span class="comment">//创建 Messenger</span></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="comment">//绑定成功后返回Messenger</span></div><div class="line">        <span class="keyword">return</span> mMessenger.getBinder();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>MainActivity.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Messenger mGetReplyMessenger = <span class="keyword">new</span> Messenger(<span class="keyword">new</span> MessengerHandler());</div><div class="line">    <span class="keyword">private</span> Messenger mMessenger = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">//接收并处理 Service 传来的消息</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MessengerHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</div><div class="line">            <span class="keyword">switch</span> (msg.what) &#123;</div><div class="line">                <span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">                    Log.d(<span class="string">"reply"</span>, msg.getData().getString(<span class="string">"reply"</span>));<span class="comment">//获取消息内容并输出 log</span></div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                <span class="keyword">default</span>:</div><div class="line">                    <span class="keyword">super</span>.handleMessage(msg);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ServiceConnection mConnection = <span class="keyword">new</span> ServiceConnection() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="comment">//绑定成功后的回调</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</div><div class="line">            mMessenger = <span class="keyword">new</span> Messenger(service);<span class="comment">//获取 Messenger</span></div><div class="line">            Message msg = Message.obtain(<span class="keyword">null</span>, <span class="number">1</span>);<span class="comment">//创建消息</span></div><div class="line">            Bundle data = <span class="keyword">new</span> Bundle();<span class="comment">//创建 Bundle</span></div><div class="line">            data.putString(<span class="string">"msg"</span>, <span class="string">"hello"</span>);<span class="comment">//为 Bundle 添加内容</span></div><div class="line">            msg.setData(data);<span class="comment">//为消息添加 Bundle</span></div><div class="line">            msg.replyTo = mGetReplyMessenger;<span class="comment">//为消息添加reply</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                mMessenger.send(msg);<span class="comment">//发送消息到 Service</span></div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line"></div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>, BookService.class);</div><div class="line">        bindService(intent, mConnection, BIND_AUTO_CREATE);<span class="comment">//绑定消息并设置绑定成功回调</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">08-11 15:28:13.797 28106-28106/com.lu.ipc:remote D/BookService: msg:hello</div><div class="line">08-11 15:28:13.826 27925-27925/com.lu.ipc D/reply: world</div></pre></td></tr></table></figure>
<p>附上 Messenger 通信的工作原理图</p>
<p> <img src="content/images/2016/08/屏幕快照 2016-08-11 15.42.15.png" alt="屏幕快照 2016-08-11 15.42.15"></p>
<h3 id="使用AIDL"><a href="#使用AIDL" class="headerlink" title="使用AIDL"></a>使用AIDL</h3><h4 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h4><p>服务端需要创建一个 Service 用来监听客户端的连接请求,然后创建一个AIDL 文件,AIDL 中声明需要暴率给客户端的接口,再 Service 中实现 AIDL 接口</p>
<h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><p>客户端成功绑定 Service 后将客户端返回的 Binder 对象转成 AIDL 接口所属的类型即可进行方法的调用.</p>
<h4 id="ADIL-支持的数据类型"><a href="#ADIL-支持的数据类型" class="headerlink" title="ADIL 支持的数据类型"></a>ADIL 支持的数据类型</h4><ul>
<li>基本数据类型 int long char boolean double</li>
<li>String 和 CharSequence</li>
<li>List：只支持 ArrayList 且要求里面的元素为 ADIL 支持的类型</li>
<li>Map：只支持 HashMap 且要求里面的元素为 ADIL 支持的类型</li>
<li>Parcelable：所有实现了该接口的对象</li>
<li>AIDL：所有的 AIDL 接口本身也可以再 AIDL 中使用</li>
</ul>
<blockquote>
<p>注：AIDL 和 Parcelable 必须显示的 import</p>
<p>如果 AIDL 使用了自定义的 Parcelable 对象,必须新建一个同名的 AIDL 文件,然再其中通过 parcelable 声明类型,例如之前提到的 Book.aidl</p>
</blockquote>
<h4 id="AIDL-接口的创建"><a href="#AIDL-接口的创建" class="headerlink" title="AIDL 接口的创建"></a>AIDL 接口的创建</h4><p><strong>Book.aidl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Book.aidl</span></div><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line">parcelable Book;</div></pre></td></tr></table></figure>
<p><strong>IBookManager.aidl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IBookManager.aidl</span></div><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> com.lu.ipc.aidl.Book;</div><div class="line"><span class="keyword">import</span> com.lu.ipc.aidl.IOnNewBookArrivedListener;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IBookManager</span> </span>&#123;</div><div class="line">    <span class="function">List&lt;Book&gt; <span class="title">getBookList</span><span class="params">()</span></span>;<span class="comment">//获取数据</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addBook</span><span class="params">(in Book book)</span></span>;<span class="comment">//添加数据</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">registerListener</span><span class="params">(IOnNewBookArrivedListener listener)</span></span>;<span class="comment">//添加监听</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unregisterListener</span><span class="params">(IOnNewBookArrivedListener listener)</span></span>;<span class="comment">//取消监听</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>IOnNewBookArrivedListener.aidl</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IOnNewBookArrivedListener.aidl</span></div><div class="line"><span class="keyword">package</span> com.lu.ipc.aidl;</div><div class="line"></div><div class="line"><span class="comment">// Declare any non-default types here with import statements</span></div><div class="line"><span class="keyword">import</span> com.lu.ipc.aidl.Book;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">IOnNewBookArrivedListener</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onNewBookArrived</span><span class="params">(in Book newBook)</span></span>;<span class="comment">//回调接口</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面三个文件就稍微解释下.</p>
<p>第一个是实体类的 AIDL 声明.之前说过很多次了…</p>
<p>第二个就理解成是定义可以再客户端调用的服务端中的方法…</p>
<p>第三个是回调接口…就是在客户端中实现该方法.然后注册到服务端中.服务端可以在指定时候调用这个方法.啊…就是 CallBack…我感觉我解释的有问题…可以看下下面的效果…</p>
<p>服务端实现 <strong>BookService.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookManagerService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> CopyOnWriteArrayList&lt;Book&gt; mBookList = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();<span class="comment">//用户保存Book列表</span></div><div class="line">    <span class="keyword">private</span> RemoteCallbackList&lt;IOnNewBookArrivedListener&gt; mListenerList = <span class="keyword">new</span> RemoteCallbackList&lt;&gt;();<span class="comment">//用户包括监听列表</span></div><div class="line">    <span class="comment">//实现 AIDL 接口</span></div><div class="line">    <span class="keyword">private</span> Binder mBinder = <span class="keyword">new</span> IBookManager.Stub() &#123;</div><div class="line">        <span class="comment">//获取Book的方法</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> List&lt;Book&gt; <span class="title">getBookList</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            <span class="keyword">return</span> mBookList;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//添加Book的方法</span></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBook</span><span class="params">(Book book)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            mBookList.add(book);<span class="comment">//添加Book</span></div><div class="line">            <span class="keyword">final</span> <span class="keyword">int</span> N = mListenerList.beginBroadcast();<span class="comment">//在需要遍历RemoteCallBackList的时候用户获取 list 长度的方法.</span></div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">                mListenerList.getBroadcastItem(i).onNewBookArrived(book);<span class="comment">//获取到监听后通知客户端.</span></div><div class="line">            &#125;</div><div class="line">            mListenerList.finishBroadcast();<span class="comment">//与beginBroadcast成对使用.</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerListener</span><span class="params">(IOnNewBookArrivedListener listener)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            mListenerList.register(listener);<span class="comment">//往监听列表中添加监听</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregisterListener</span><span class="params">(IOnNewBookArrivedListener listener)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            mListenerList.unregister(listener);<span class="comment">//从监听列表中移除监听</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mBinder;<span class="comment">//放回服务器 Binder</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>客户端实现 <strong>ThreeActivity.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreeActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> IBookManager bookManager = <span class="keyword">null</span>;<span class="comment">//服务器 binder</span></div><div class="line">    <span class="keyword">private</span> ServiceConnection mConnection = <span class="keyword">new</span> ServiceConnection() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;<span class="comment">//启动并绑定服务后被调用</span></div><div class="line">            bookManager = IBookManager.Stub.asInterface(service);<span class="comment">//获取并保存服务器 binder</span></div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                bookManager.registerListener(mOnNewBookArrivedListener);<span class="comment">//注册监听.</span></div><div class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//客户端回调.在服务端执行onNewBookArrived 时被调用</span></div><div class="line">    <span class="keyword">private</span> IOnNewBookArrivedListener mOnNewBookArrivedListener = <span class="keyword">new</span> IOnNewBookArrivedListener.Stub() &#123;</div><div class="line"></div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNewBookArrived</span><span class="params">(Book newBook)</span> <span class="keyword">throws</span> RemoteException </span>&#123;</div><div class="line">            Log.d(<span class="string">"TwoActivity"</span>, newBook.bookId + <span class="string">""</span>);<span class="comment">//输出 log</span></div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_two);</div><div class="line"></div><div class="line">        findViewById(R.id.button).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    bookManager.addBook(<span class="keyword">new</span> Book(<span class="number">10</span>));<span class="comment">//点击按钮后往服务器添加一个Book</span></div><div class="line">                &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        Intent intent = <span class="keyword">new</span> Intent(ThreeActivity.<span class="keyword">this</span>, BookManagerService.class);</div><div class="line">        bindService(intent, mConnection, BIND_AUTO_CREATE);<span class="comment">//绑定服务.设置绑定成功后的回调</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行代码后点击按钮就可以看到有输出 log 信息.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">08-12 17:59:42.114 13209-13209/com.lu.ipc:remote D/TwoActivity: 10</div></pre></td></tr></table></figure>
<p><strong>注意：在客户端中调用服务端的方法是在 UI 线程中操作的.如果服务端中执行的是一个耗时操作的话很有可能会产生 ANR（应用程序无响应）所以需要移到非 UI 线程中执行</strong></p>
<p>还有…因为回调方法其实是运行再 Binder 中的.不能直接操作 UI 相关内容.可以通过 Handler切换到 UI 线程中再去操作 UI</p>
<h3 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h3><p>ContentProvider是 Android 中专门用于不同应用间进行数据共享,所以它也非常适合进程间通信.他的底层实现其实也是 Binder.</p>
<p>具体实现方式…</p>
<p>BookProvider.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span></span></div></pre></td></tr></table></figure>
<p>就写这一行…然后实现 ContentProvider 里面的函数</p>
<p>调用方式.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(<span class="string">"content://com.lu.ipc.provider.BookProvider"</span>);</div><div class="line">getContentResolver().query(uri, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">getContentResolver().delete(uri, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line">getContentResolver().getType(uri);</div></pre></td></tr></table></figure>
<p>当然…这个 Uri 不是乱写的.是再创建 BookProvider.java之后是需要再 AndroidManifest.xml 里面注册的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">provider</span></span></div><div class="line">	<span class="attr">android:name</span>=<span class="string">".provider.BookProvider"</span></div><div class="line">	<span class="attr">android:authorities</span>=<span class="string">"com.lu.ipc.provider.BookProvider"</span></div><div class="line">	<span class="attr">android:process</span>=<span class="string">":remote"</span> /&gt;</div></pre></td></tr></table></figure>
<p>别怪我写的随意…讲道理…我又不喜欢用这个…</p>
<h3 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h3><p>我很淡定的跳过了这一部分…有空补上这个.</p>
<p>##选用合适的 IPC 方式<br><img src="content/images/2016/08/屏幕快照 2016-08-13 16.03.34.png" alt=""></p>
<h2 id="Binder连接池"><a href="#Binder连接池" class="headerlink" title="Binder连接池"></a>Binder连接池</h2><p>没太懂书上将的一些东西.只是大概知道一部分.主要是解决 Binder 过多的时候不至于创建一堆 Service 这个问题.每个 Binder 都单独创建一个类.实现AIDL 中的方法.再创建一个 AIDL 中只包含一个<code>IBinder queryBinder(int binderCode);</code>方法.这个方法的实现.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">IBinder binder = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">switch</span> (binderCode) &#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">		binder = <span class="keyword">new</span> SecurityCenterImpl();</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">2</span>:</div><div class="line">		binder = <span class="keyword">new</span> ComputeImpl();</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> binder;</div></pre></td></tr></table></figure>
<p>关于这个 AIDL 的调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">IBinder securityBinder = mBinderPool.queryBinder(<span class="number">1</span>);</div><div class="line">mSecurityCenter = SecurityCenterImpl.asInterface(securityBinder);</div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">	String hello = mSecurityCenter.decrypt(<span class="string">"hello"</span>);</div><div class="line">	Log.d(<span class="string">"Four"</span>, hello);</div><div class="line">&#125; <span class="keyword">catch</span> (RemoteException e) &#123;</div><div class="line">	e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以就是创建了一个 Service 用了分发对于 Binder 的调用.或者可以说是创建了一个 Service 用于查询 Binder.</p>
<blockquote>
<p>本文内容主要来源于《Android开发艺术探索》.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/08/13/Android 多进程 IPC/" data-id="cirt8jj3800015ceo1ivlpiyy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/IPC/">IPC</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Android动态加载" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/08/04/Android动态加载/" class="article-date">
  <time datetime="2016-08-04T12:59:00.000Z" itemprop="datePublished">2016-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/08/04/Android动态加载/">Android动态加载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近因为接口问题搞得有点头大.感觉每次因为接口变动而更新 APP 是会被用户骂死的.所以想起了 JAVA 的反射机制.也就来了一波动态加载.</p>
<p>百度百科解释的 JAVA 反射</p>
<blockquote>
<p>JAVA反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象，都能够调用它的任意一个方法和属性；这种动态获取的信息以及动态调用对象的方法的功能称为java语言的反射机制。</p>
</blockquote>
<p>然后是动态加载</p>
<blockquote>
<p>在程序运行的时候，加载一些程序自身原本不存在的可执行文件并运行这些文件里的代码逻辑。</p>
</blockquote>
<p>这两者之间的关系就是使用反射机制达到动态加载的效果.很简单的.</p>
<p>因为我这里要处理的问题有两个.一个是接口地址的变动.一个是接口返回数据格式的变动.</p>
<p>第一个问题很好解决.服务器上保存一个文本文档.内容包含接口地址的变量名和值.本地检查文本文档的版本号.发现有更新就下载文本文档.这个我也就不多讲.主要是在更新接口文件后加载这个文件.查看文件内容.更具内容来修改接口地址的值.也就是需要通过反射机制来修改 JAVA 文件了.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">File file = <span class="keyword">new</span> File(<span class="string">"/data/data/com.mcdull.cert/files/url"</span>);<span class="comment">//加载文件</span></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(file));</div><div class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</div><div class="line">    String s = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">while</span> ((s = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</div><div class="line">        String name = s;<span class="comment">//读取文件内容</span></div><div class="line">        String url = bufferedReader.readLine();<span class="comment">//读取文件内容</span></div><div class="line">        Class aClass = Class.forName(<span class="string">"com.mcdull.cert.utils.InternetUtil"</span>);<span class="comment">//反射获取包含接口地址信息的JAVA 文件</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Field field = aClass.getField(name);<span class="comment">//获取变量</span></div><div class="line">            field.set(aClass, url);<span class="comment">//为变量赋值</span></div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个就是具体的实现代码.有一个地方要注意的就是再获取变量这个地方.编译器不会提示错误或者异常.是因为外部抛了一个更大的异常.但是这里不一定包含name 这个名字的变量.所以需要自己手抛一个异常进行处理…</p>
<p>这个还是比较简单的反射.只是读取文件和设置变量.接下来是需要通过反射来实现动态加载json解析的函数.</p>
<p>本来想讲下错误案例的…想想还是先讲下正确的做法.有空再在最后补充下有可能出现的错误…</p>
<p>因为我这里讲的是 Android 动态加载.所以就打开你的 Android 工程吧.在你的项目那右键–&gt;new–&gt;Module–&gt;Android Library 然后输入一些信息就会自动创建完成了.<br><br>创建好之后应该是这样的.<br><img src="content/images/2016/08/-----2016-08-04-20-41-24.png" alt=""><br>然后先不管他.先在你自己的工程中创建一个abstract<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.mcdull.cert.json;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="keyword">import</span> dalvik.system.DexClassLoader;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Begin on 16/8/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbsJsonUtil</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;List&lt;String&gt;&gt; scoreParseJson(String s);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AbsJsonUtil <span class="title">getJsonUtil</span><span class="params">(Context context)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        DexClassLoader dexClassLoader = <span class="keyword">new</span> DexClassLoader(<span class="string">"/data/data/com.mcdull.cert/files/json.jar"</span>, context.getDir(<span class="string">"dex"</span>, Context.MODE_PRIVATE).getAbsolutePath(), <span class="keyword">null</span>, context.getClassLoader());</div><div class="line">        Class&lt;?&gt; myClass1 = dexClassLoader.loadClass(<span class="string">"com.lu.json.JsonUtil"</span>);<span class="comment">//通过反射加载 JsonUtil</span></div><div class="line">        <span class="keyword">return</span> (AbsJsonUtil) myClass1.newInstance();<span class="comment">//获取到实现后的 AbsJsonUtil</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个代码中主要是包含解析 json 的接口.也就是动态加载的内容中所需要实现的接口.和一个动态加载函数.我主要讲一下动态加载函数.</p>
<p>这里是使用的 DexClassLoader 和 JAVA 中使用的 UrlClassLoader 不一样.原因我就不讲了.主要是 Android 和 JAVA 的运行机制不一样.这里 DexClassLoader 的四个参数分别是自己生成的 jar 包的路径，临时 dex 存放路径，所需要加载的本地 dex 路径和加载器.</p>
<p>然后把它复制一份到刚刚创建的 Module 中的 java 文件夹下.注意包结构要和 Android 项目中的一致.然后再创建一个不同包结构的 JsonUtil 类继承 AbsJsonUtil注意是不同包结构.相同肯定会出问题.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.lu.json;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.mcdull.cert.json.AbsJsonUtil;</div><div class="line"><span class="keyword">import</span> org.json.JSONArray;</div><div class="line"><span class="keyword">import</span> org.json.JSONException;</div><div class="line"><span class="keyword">import</span> org.json.JSONObject;</div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.LinkedList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by Begin on 16/8/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonUtil</span> <span class="keyword">extends</span> <span class="title">AbsJsonUtil</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="keyword">public</span> List&lt;List&lt;String&gt;&gt; scoreParseJson(String s) &#123;</div><div class="line">        List&lt;List&lt;String&gt;&gt; lists = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            JSONObject jsonObject = <span class="keyword">new</span> JSONObject(s);</div><div class="line">            JSONArray data = jsonObject.getJSONArray(<span class="string">"data"</span>);</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; data.length(); i++) &#123;</div><div class="line">                JSONObject object = (JSONObject) data.get(i);</div><div class="line">                List&lt;String&gt; list = <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">                list.add(object.getString(<span class="string">"course"</span>));</div><div class="line">                list.add(object.getString(<span class="string">"score"</span>));</div><div class="line">                list.add(object.getString(<span class="string">"credit"</span>));</div><div class="line">                lists.add(list);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (JSONException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> lists;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个代码没什么看的.就是实现 json 解析.</p>
<p>然后就是在需要调用的地方使用如下代码进行调用就行了.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lists =AbsJsonUtil.getJsonUtil(<span class="keyword">this</span>).scoreParseJson(scoreJson);</div></pre></td></tr></table></figure></p>
<p>看上去好像没什么问题.但是还有一个步骤.很重要的步骤.那就是生成 jar 包.没生成 jar 包去给应用进行更新.哪来的动态加载…</p>
<p>现在需要打开Module中的build.gradle来修改修改.<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.library'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">24</span></div><div class="line">    buildToolsVersion <span class="string">"23.0.2"</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        minSdkVersion <span class="number">16</span></div><div class="line">        targetSdkVersion <span class="number">24</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled <span class="keyword">false</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">    testCompile <span class="string">'junit:junit:4.12'</span></div><div class="line">    <span class="keyword">compile</span> <span class="string">'com.android.support:appcompat-v7:24.1.1'</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//dependsOn 可根据实际需要增加或更改</span></div><div class="line"><span class="keyword">task</span> buildJar(dependsOn: [<span class="string">'compileReleaseJavaWithJavac'</span>], type: Jar) &#123;</div><div class="line">    appendix = <span class="string">"demo"</span></div><div class="line">    baseName = <span class="string">"androidJar"</span></div><div class="line">    version = <span class="string">"1.0.0"</span></div><div class="line">    classifier = <span class="string">"release"</span></div><div class="line">    <span class="comment">//后缀名</span></div><div class="line">    extension = <span class="string">"jar"</span></div><div class="line">    <span class="comment">//最终的 Jar 包名，如果没设置，默认为 [baseName]-[appendix]-[version]-[classifier].[extension]</span></div><div class="line">    archiveName = <span class="string">"json.jar"</span></div><div class="line">    <span class="comment">//需打包的资源所在的路径集</span></div><div class="line">    <span class="keyword">def</span> srcClassDir = [<span class="keyword">project</span>.buildDir.absolutePath + <span class="string">"/intermediates/classes/release"</span>];</div><div class="line">    <span class="comment">//初始化资源路径集</span></div><div class="line">    <span class="keyword">from</span> srcClassDir</div><div class="line">    <span class="comment">//去除路径集下部分的资源</span></div><div class="line"><span class="comment">//    exclude "**/R.class"</span></div><div class="line"><span class="comment">//    exclude "**/R\$*.class"</span></div><div class="line">    <span class="comment">//只导入资源路径集下的部分资源</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"com/lu/json/*.class"</span></div><div class="line">    <span class="comment">//注: exclude include 支持可变长参数</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后运行<code>./gradlew buildJar</code>就生成了 jar 包.但是这并没有什么用处.你使用这个 jar 包进行反射的时候会提示<code>doesn&#39;t contain classes.dex</code>所以还需要由sdk 自带的 dx 工具对 jar 进行再一次打包 <code>./dx --dex --output=打包后文件 被打包文件</code>这样就可以进行反射了…（dx工具在 build-tools 里面）</p>
<p>再贴一下我 copy 的gradle 代码<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.android.build.gradle.AppPlugin</div><div class="line"><span class="keyword">import</span> com.android.build.gradle.LibraryPlugin</div><div class="line"><span class="keyword">import</span> proguard.gradle.ProGuardTask</div><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">23</span></div><div class="line">    buildToolsVersion <span class="string">"23.0.2"</span></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="string">"org.chaos.demo.jar"</span></div><div class="line">        minSdkVersion <span class="number">19</span></div><div class="line">        targetSdkVersion <span class="number">22</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        release &#123;</div><div class="line">            minifyEnabled <span class="keyword">true</span></div><div class="line">            proguardFiles getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>), <span class="string">'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">dependencies</span> &#123;</div><div class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">'libs'</span>, <span class="keyword">include</span>: [<span class="string">'*.jar'</span>])</div><div class="line">&#125;</div><div class="line"><span class="comment">//dependsOn 可根据实际需要增加或更改</span></div><div class="line"><span class="keyword">task</span> buildJar(dependsOn: [<span class="string">'compileReleaseJavaWithJavac'</span>], type: Jar) &#123;</div><div class="line">    appendix = <span class="string">"demo"</span></div><div class="line">    baseName = <span class="string">"androidJar"</span></div><div class="line">    version = <span class="string">"1.0.0"</span></div><div class="line">    classifier = <span class="string">"release"</span></div><div class="line">    <span class="comment">//后缀名</span></div><div class="line">    extension = <span class="string">"jar"</span></div><div class="line">    <span class="comment">//最终的 Jar 包名，如果没设置，默认为 [baseName]-[appendix]-[version]-[classifier].[extension]</span></div><div class="line">    archiveName = <span class="string">"AndroidJarDemo.jar"</span></div><div class="line">    <span class="comment">//需打包的资源所在的路径集</span></div><div class="line">    <span class="keyword">def</span> srcClassDir = [<span class="keyword">project</span>.buildDir.absolutePath + <span class="string">"/intermediates/classes/release"</span>];</div><div class="line">    <span class="comment">//初始化资源路径集</span></div><div class="line">    <span class="keyword">from</span> srcClassDir</div><div class="line">    <span class="comment">//去除路径集下部分的资源</span></div><div class="line"><span class="comment">//    exclude "org/chaos/demo/jar/MainActivity.class"</span></div><div class="line"><span class="comment">//    exclude "org/chaos/demo/jar/MainActivity\$*.class"</span></div><div class="line"><span class="comment">//    exclude "org/chaos/demo/jar/BuildConfig.class"</span></div><div class="line"><span class="comment">//    exclude "org/chaos/demo/jar/BuildConfig\$*.class"</span></div><div class="line"><span class="comment">//    exclude "**/R.class"</span></div><div class="line"><span class="comment">//    exclude "**/R\$*.class"</span></div><div class="line">    <span class="comment">//只导入资源路径集下的部分资源</span></div><div class="line">    <span class="keyword">include</span> <span class="string">"org/chaos/demo/jar/**/*.class"</span></div><div class="line">    <span class="comment">//注: exclude include 支持可变长参数</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">task</span> proguardJar(dependsOn: [<span class="string">'buildJar'</span>], type: ProGuardTask) &#123;</div><div class="line">    <span class="comment">//Android 默认的 proguard 文件</span></div><div class="line">    configuration android.getDefaultProguardFile(<span class="string">'proguard-android.txt'</span>)</div><div class="line">    <span class="comment">//manifest 注册的组件对应的 proguard 文件</span></div><div class="line">    configuration <span class="keyword">project</span>.buildDir.absolutePath + <span class="string">"/intermediates/proguard-rules/release/aapt_rules.txt"</span></div><div class="line">    configuration <span class="string">'proguard-rules.pro'</span></div><div class="line">    String inJar = buildJar.archivePath.getAbsolutePath()</div><div class="line">    <span class="comment">//输入 jar</span></div><div class="line">    injars inJar</div><div class="line">    <span class="comment">//输出 jar</span></div><div class="line">    outjars inJar.substring(<span class="number">0</span>, inJar.lastIndexOf(<span class="string">'/'</span>)) + <span class="string">"/proguard-$&#123;buildJar.archiveName&#125;"</span></div><div class="line">    <span class="comment">//设置不删除未引用的资源(类，方法等)</span></div><div class="line">    dontshrink</div><div class="line">    Plugin plugin = getPlugins().hasPlugin(AppPlugin) ?</div><div class="line">            getPlugins().findPlugin(AppPlugin) :</div><div class="line">            getPlugins().findPlugin(LibraryPlugin)</div><div class="line">    <span class="keyword">if</span> (plugin != <span class="keyword">null</span>) &#123;</div><div class="line">        List&lt;String&gt; runtimeJarList</div><div class="line">        <span class="keyword">if</span> (plugin.getMetaClass().getMetaMethod(<span class="string">"getRuntimeJarList"</span>)) &#123;</div><div class="line">            runtimeJarList = plugin.getRuntimeJarList()</div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (android.getMetaClass().getMetaMethod(<span class="string">"getBootClasspath"</span>)) &#123;</div><div class="line">            runtimeJarList = android.getBootClasspath()</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            runtimeJarList = plugin.getBootClasspath()</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (String runtimeJar : runtimeJarList) &#123;</div><div class="line">            <span class="comment">//给 proguard 添加 runtime</span></div><div class="line">            libraryjars(runtimeJar)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要代码混淆使用<code>./gradlew proguardJar</code></p>
</blockquote>
<p>讲的有点乱…</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/08/04/Android动态加载/" data-id="cirt8jj4000085ceoiyt1w6i6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/反射/">反射</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-转-详解Java中使用ImageIO类对图片进行压缩的方法" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/08/04/转-详解Java中使用ImageIO类对图片进行压缩的方法/" class="article-date">
  <time datetime="2016-08-04T10:42:05.000Z" itemprop="datePublished">2016-08-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/08/04/转-详解Java中使用ImageIO类对图片进行压缩的方法/">转-详解Java中使用ImageIO类对图片进行压缩的方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>可以压缩为任意大小，压缩后高清，不变形（留白），可以改后缀名，可以修改压缩分辨率。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.com.images; </div><div class="line"> </div><div class="line"><span class="keyword">import</span> java.awt.Graphics; </div><div class="line"><span class="keyword">import</span> java.awt.Image; </div><div class="line"><span class="keyword">import</span> java.awt.image.BufferedImage; </div><div class="line"><span class="keyword">import</span> java.io.File; </div><div class="line"><span class="keyword">import</span> java.io.IOException; </div><div class="line"><span class="keyword">import</span> java.math.BigDecimal; </div><div class="line"><span class="keyword">import</span> java.math.MathContext; </div><div class="line"><span class="keyword">import</span> java.util.ArrayList; </div><div class="line"> </div><div class="line"><span class="keyword">import</span> javax.imageio.ImageIO; </div><div class="line"> </div><div class="line"><span class="comment">/*** </span></div><div class="line"> * 对图片进行操作 </div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> chenzheng_java </div><div class="line"> * <span class="doctag">@since</span> 2011/7/29 </div><div class="line"> * </div><div class="line"> */ </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ImageHelper</span> </span>&#123; </div><div class="line"> </div><div class="line">  <span class="keyword">private</span> <span class="keyword">static</span> ImageHelper imageHelper = <span class="keyword">null</span>; </div><div class="line"> </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ImageHelper <span class="title">getImageHelper</span><span class="params">()</span> </span>&#123; </div><div class="line">    <span class="keyword">if</span> (imageHelper == <span class="keyword">null</span>) &#123; </div><div class="line">      imageHelper = <span class="keyword">new</span> ImageHelper(); </div><div class="line">    &#125; </div><div class="line">    <span class="keyword">return</span> imageHelper; </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">  <span class="comment">/*** </span></div><div class="line">   * 按指定的比例缩放图片 </div><div class="line">   * </div><div class="line">   * <span class="doctag">@param</span> sourceImagePath </div><div class="line">   *      源地址 </div><div class="line">   * <span class="doctag">@param</span> destinationPath </div><div class="line">   *      改变大小后图片的地址 </div><div class="line">   * <span class="doctag">@param</span> scale </div><div class="line">   *      缩放比例，如1.2 </div><div class="line">   */ </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scaleImage</span><span class="params">(String sourceImagePath, </span></span></div><div class="line">      String destinationPath, <span class="keyword">double</span> scale,String format) &#123; </div><div class="line"> </div><div class="line">    File file = <span class="keyword">new</span> File(sourceImagePath); </div><div class="line">    BufferedImage bufferedImage; </div><div class="line">    <span class="keyword">try</span> &#123; </div><div class="line">      bufferedImage = ImageIO.read(file); </div><div class="line">      <span class="keyword">int</span> width = bufferedImage.getWidth(); </div><div class="line">      <span class="keyword">int</span> height = bufferedImage.getHeight(); </div><div class="line"> </div><div class="line">      width = parseDoubleToInt(width * scale); </div><div class="line">      height = parseDoubleToInt(height * scale); </div><div class="line"> </div><div class="line">      Image image = bufferedImage.getScaledInstance(width, height, </div><div class="line">          Image.SCALE_SMOOTH); </div><div class="line">      BufferedImage outputImage = <span class="keyword">new</span> BufferedImage(width, height, </div><div class="line">          BufferedImage.TYPE_INT_RGB); </div><div class="line">      Graphics graphics = outputImage.getGraphics(); </div><div class="line">      graphics.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>); </div><div class="line">      graphics.dispose(); </div><div class="line"> </div><div class="line">      ImageIO.write(outputImage, format, <span class="keyword">new</span> File(destinationPath)); </div><div class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123; </div><div class="line">      System.out.println(<span class="string">"scaleImage方法压缩图片时出错了"</span>); </div><div class="line">      e.printStackTrace(); </div><div class="line">    &#125; </div><div class="line"> </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">  <span class="comment">/*** </span></div><div class="line">   * 将图片缩放到指定的高度或者宽度 </div><div class="line">   * <span class="doctag">@param</span> sourceImagePath 图片源地址 </div><div class="line">   * <span class="doctag">@param</span> destinationPath 压缩完图片的地址 </div><div class="line">   * <span class="doctag">@param</span> width 缩放后的宽度 </div><div class="line">   * <span class="doctag">@param</span> height 缩放后的高度 </div><div class="line">   * <span class="doctag">@param</span> auto 是否自动保持图片的原高宽比例 </div><div class="line">   * <span class="doctag">@param</span> format 图图片格式 例如 jpg </div><div class="line">   */ </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scaleImageWithParams</span><span class="params">(String sourceImagePath, </span></span></div><div class="line">      String destinationPath, <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">boolean</span> auto,String format) &#123; </div><div class="line">     </div><div class="line">    <span class="keyword">try</span> &#123; </div><div class="line">    File file = <span class="keyword">new</span> File(sourceImagePath); </div><div class="line">    BufferedImage bufferedImage = <span class="keyword">null</span>; </div><div class="line">    bufferedImage = ImageIO.read(file); </div><div class="line">      <span class="keyword">if</span> (auto) &#123; </div><div class="line">        ArrayList&lt;Integer&gt; paramsArrayList = getAutoWidthAndHeight(bufferedImage,width,height); </div><div class="line">        width = paramsArrayList.get(<span class="number">0</span>); </div><div class="line">        height = paramsArrayList.get(<span class="number">1</span>); </div><div class="line">        System.out.println(<span class="string">"自动调整比例，width="</span>+width+<span class="string">" height="</span>+height); </div><div class="line">      &#125; </div><div class="line">     </div><div class="line">    Image image = bufferedImage.getScaledInstance(width, height, </div><div class="line">        Image.SCALE_DEFAULT); </div><div class="line">    BufferedImage outputImage = <span class="keyword">new</span> BufferedImage(width, height, </div><div class="line">        BufferedImage.TYPE_INT_RGB); </div><div class="line">    Graphics graphics = outputImage.getGraphics(); </div><div class="line">    graphics.drawImage(image, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>); </div><div class="line">    graphics.dispose(); </div><div class="line">    ImageIO.write(outputImage, format, <span class="keyword">new</span> File(destinationPath)); </div><div class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123; </div><div class="line">      System.out.println(<span class="string">"scaleImageWithParams方法压缩图片时出错了"</span>); </div><div class="line">      e.printStackTrace(); </div><div class="line">    &#125; </div><div class="line">     </div><div class="line">     </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">  <span class="comment">/** </span></div><div class="line">   * 将double类型的数据转换为int，四舍五入原则 </div><div class="line">   * </div><div class="line">   * <span class="doctag">@param</span> sourceDouble </div><div class="line">   * <span class="doctag">@return</span> </div><div class="line">   */ </div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">parseDoubleToInt</span><span class="params">(<span class="keyword">double</span> sourceDouble)</span> </span>&#123; </div><div class="line">    <span class="keyword">int</span> result = <span class="number">0</span>; </div><div class="line">    result = (<span class="keyword">int</span>) sourceDouble; </div><div class="line">    <span class="keyword">return</span> result; </div><div class="line">  &#125; </div><div class="line">   </div><div class="line">  <span class="comment">/*** </span></div><div class="line">   * </div><div class="line">   * <span class="doctag">@param</span> bufferedImage 要缩放的图片对象 </div><div class="line">   * <span class="doctag">@param</span> width_scale 要缩放到的宽度 </div><div class="line">   * <span class="doctag">@param</span> height_scale 要缩放到的高度 </div><div class="line">   * <span class="doctag">@return</span> 一个集合，第一个元素为宽度，第二个元素为高度 </div><div class="line">   */ </div><div class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ArrayList&lt;Integer&gt; <span class="title">getAutoWidthAndHeight</span><span class="params">(BufferedImage bufferedImage,<span class="keyword">int</span> width_scale,<span class="keyword">int</span> height_scale)</span></span>&#123; </div><div class="line">    ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> ArrayList&lt;Integer&gt;(); </div><div class="line">    <span class="keyword">int</span> width = bufferedImage.getWidth(); </div><div class="line">    <span class="keyword">int</span> height = bufferedImage.getHeight(); </div><div class="line">    <span class="keyword">double</span> scale_w =getDot2Decimal( width_scale,width); </div><div class="line">     </div><div class="line">    System.out.println(<span class="string">"getAutoWidthAndHeight width="</span>+width + <span class="string">"scale_w="</span>+scale_w); </div><div class="line">    <span class="keyword">double</span> scale_h = getDot2Decimal(height_scale,height); </div><div class="line">    <span class="keyword">if</span> (scale_w&lt;scale_h) &#123; </div><div class="line">      arrayList.add(parseDoubleToInt(scale_w*width)); </div><div class="line">      arrayList.add(parseDoubleToInt(scale_w*height)); </div><div class="line">    &#125; </div><div class="line">    <span class="keyword">else</span> &#123; </div><div class="line">      arrayList.add(parseDoubleToInt(scale_h*width)); </div><div class="line">      arrayList.add(parseDoubleToInt(scale_h*height)); </div><div class="line">    &#125; </div><div class="line">    <span class="keyword">return</span> arrayList; </div><div class="line">     </div><div class="line">  &#125; </div><div class="line">   </div><div class="line">   </div><div class="line">  <span class="comment">/*** </span></div><div class="line">   * 返回两个数a/b的小数点后三位的表示 </div><div class="line">   * <span class="doctag">@param</span> a </div><div class="line">   * <span class="doctag">@param</span> b </div><div class="line">   * <span class="doctag">@return</span> </div><div class="line">   */ </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">double</span> <span class="title">getDot2Decimal</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123; </div><div class="line">     </div><div class="line">    BigDecimal bigDecimal_1 = <span class="keyword">new</span> BigDecimal(a); </div><div class="line">    BigDecimal bigDecimal_2 = <span class="keyword">new</span> BigDecimal(b); </div><div class="line">    BigDecimal bigDecimal_result = bigDecimal_1.divide(bigDecimal_2,<span class="keyword">new</span> MathContext(<span class="number">4</span>)); </div><div class="line">    Double double1 = <span class="keyword">new</span> Double(bigDecimal_result.toString()); </div><div class="line">    System.out.println(<span class="string">"相除后的double为："</span>+double1); </div><div class="line">    <span class="keyword">return</span> double1; </div><div class="line">  &#125; </div><div class="line"> </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>原作者：未知…’,’</p><p>可以压缩为任意大小，压缩后高清，不变形（留白），可以改后缀名，可以修改压缩分辨率。 </p><p></p>
<pre><code class="language-java">package cn.com.images; 

import java.awt.Graphics;  
import java.awt.Image;  
import java.awt.image.BufferedImage;  
import java.io.File;  
import java.io.IOException;  
import java.math.BigDecimal;  
import java.math.MathContext;  
import java.util.ArrayList; 

import javax.imageio.ImageIO; 

/*** 
 * 对图片进行操作 
 * 
 * @author chenzheng_java 
 * @since 2011/7/29 
 * 
 */ 
public class ImageHelper { 

  private static ImageHelper imageHelper = null; 

  public static ImageHelper getImageHelper() { 
    if (imageHelper == null) { 
      imageHelper = new ImageHelper(); 
    } 
    return imageHelper; 
  } 

  /*** 
   * 按指定的比例缩放图片 
   * 
   * @param sourceImagePath 
   *      源地址 
   * @param destinationPath 
   *      改变大小后图片的地址 
   * @param scale 
   *      缩放比例，如1.2 
   */ 
  public static void scaleImage(String sourceImagePath, 
      String destinationPath, double scale,String format) { 

    File file = new File(sourceImagePath); 
    BufferedImage bufferedImage; 
    try { 
      bufferedImage = ImageIO.read(file); 
      int width = bufferedImage.getWidth(); 
      int height = bufferedImage.getHeight(); 

      width = parseDoubleToInt(width * scale); 
      height = parseDoubleToInt(height * scale); 

      Image image = bufferedImage.getScaledInstance(width, height, 
          Image.SCALE_SMOOTH); 
      BufferedImage outputImage = new BufferedImage(width, height, 
          BufferedImage.TYPE_INT_RGB); 
      Graphics graphics = outputImage.getGraphics(); 
      graphics.drawImage(image, 0, 0, null); 
      graphics.dispose(); 

      ImageIO.write(outputImage, format, new File(destinationPath)); 
    } catch (IOException e) { 
      System.out.println("scaleImage方法压缩图片时出错了"); 
      e.printStackTrace(); 
    } 

  } 

  /*** 
   * 将图片缩放到指定的高度或者宽度 
   * @param sourceImagePath 图片源地址 
   * @param destinationPath 压缩完图片的地址 
   * @param width 缩放后的宽度 
   * @param height 缩放后的高度 
   * @param auto 是否自动保持图片的原高宽比例 
   * @param format 图图片格式 例如 jpg 
   */ 
  public static void scaleImageWithParams(String sourceImagePath, 
      String destinationPath, int width, int height, boolean auto,String format) { 

    try { 
    File file = new File(sourceImagePath); 
    BufferedImage bufferedImage = null; 
    bufferedImage = ImageIO.read(file); 
      if (auto) { 
        ArrayList&lt;Integer&gt; paramsArrayList = getAutoWidthAndHeight(bufferedImage,width,height); 
        width = paramsArrayList.get(0); 
        height = paramsArrayList.get(1); 
        System.out.println("自动调整比例，width="+width+" height="+height); 
      } 

    Image image = bufferedImage.getScaledInstance(width, height, 
        Image.SCALE_DEFAULT); 
    BufferedImage outputImage = new BufferedImage(width, height, 
        BufferedImage.TYPE_INT_RGB); 
    Graphics graphics = outputImage.getGraphics(); 
    graphics.drawImage(image, 0, 0, null); 
    graphics.dispose(); 
    ImageIO.write(outputImage, format, new File(destinationPath)); 
    } catch (Exception e) { 
      System.out.println("scaleImageWithParams方法压缩图片时出错了"); 
      e.printStackTrace(); 
    } 


  } 

  /** 
   * 将double类型的数据转换为int，四舍五入原则 
   * 
   * @param sourceDouble 
   * @return 
   */ 
  private static int parseDoubleToInt(double sourceDouble) { 
    int result = 0; 
    result = (int) sourceDouble; 
    return result; 
  } 

  /*** 
   * 
   * @param bufferedImage 要缩放的图片对象 
   * @param width_scale 要缩放到的宽度 
   * @param height_scale 要缩放到的高度 
   * @return 一个集合，第一个元素为宽度，第二个元素为高度 
   */ 
  private static ArrayList&lt;Integer&gt; getAutoWidthAndHeight(BufferedImage bufferedImage,int width_scale,int height_scale){ 
    ArrayList&lt;Integer&gt; arrayList = new ArrayList&lt;Integer&gt;(); 
    int width = bufferedImage.getWidth(); 
    int height = bufferedImage.getHeight(); 
    double scale_w =getDot2Decimal( width_scale,width); 

    System.out.println("getAutoWidthAndHeight width="+width + "scale_w="+scale_w); 
    double scale_h = getDot2Decimal(height_scale,height); 
    if (scale_w&lt;scale_h) { 
      arrayList.add(parseDoubleToInt(scale_w*width)); 
      arrayList.add(parseDoubleToInt(scale_w*height)); 
    } 
    else { 
      arrayList.add(parseDoubleToInt(scale_h*width)); 
      arrayList.add(parseDoubleToInt(scale_h*height)); 
    } 
    return arrayList; 

  } 


  /*** 
   * 返回两个数a/b的小数点后三位的表示 
   * @param a 
   * @param b 
   * @return 
   */ 
  public static double getDot2Decimal(int a,int b){ 

    BigDecimal bigDecimal_1 = new BigDecimal(a); 
    BigDecimal bigDecimal_2 = new BigDecimal(b); 
    BigDecimal bigDecimal_result = bigDecimal_1.divide(bigDecimal_2,new MathContext(4)); 
    Double double1 = new Double(bigDecimal_result.toString()); 
    System.out.println("相除后的double为："+double1); 
    return double1; 
  } 

} 
</code></pre>

<p>原作者：未知…</p>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/08/04/转-详解Java中使用ImageIO类对图片进行压缩的方法/" data-id="cirt8jj5000175ceoiusk2y3k" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/ImageIO/">ImageIO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Java/">Java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-利用树莓派制作一个实时监控的遥控小车" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/07/29/利用树莓派制作一个实时监控的遥控小车/" class="article-date">
  <time datetime="2016-07-29T15:11:15.000Z" itemprop="datePublished">2016-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/07/29/利用树莓派制作一个实时监控的遥控小车/">利用树莓派制作一个实时监控的遥控小车</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="content/images/2016/07/Screenshot_2016-07-22-19-16-26-543_com-lu-che.jpg" style="float:left" width="30%"><img src="content/images/2016/07/6AC706DD27F6C6B063DF0D6EBE5D5FC3.jpg" width="30%/"></p>
<p>先上一波成果图</p>
<p>然后就是所需要的物品</p>
<p><img width="60%" src="/content/images/2016/07/IMG_20160729_212509.jpg"></p>
<p>包括树莓派（我这里是2代B+版）<br><br>L298N电机驱动板<br>小车底座轮胎电机等…<br><br>树莓派摄像头<br><br>USB 无线网卡<br><br>一把杜邦线（公对公 公对母 母对母）<br></p>
<p>因为我这里用的是移动电源为L298N供电.所以我还准备了一跟USB线。</p>
<p>然后是组装小车.底座方面没什么好说的.注意的是电机用公对公的杜邦线连.</p>
<p>连好后是这样的…</p>
<p><img width="60%" src="/content/images/2016/07/IMG_20160729_215024.jpg"><br>然后是接线<br><br>电机上接出来的八根线将左边两个电机的接到OUT1和OUT2上.右边两个电机的接 OUT3和OUT4注意 OUT1和OUT2是电流的正负.注意别把一个电机的两根线都接到同一个OUT口了.<br></p>
<p>再取两根公对公的线接12V和GND用于电机供电在取两根公对母线接5V和GND 口用于逻辑芯片供电.</p>
<p>接好后如图</p>
<p><img width="60%" src="/content/images/2016/07/IMG_20160729_215306.jpg"></p>
<p>将接12V和GND的线与USB线连接.</p>
<p>像这样.用于连接移动电源供电</p>
<p><img width="60%" src="/content/images/2016/07/IMG_20160729_220621.jpg"></p>
<p>然后再取八根母对母的线连接ENA、ENB和IN1-4<br><img width="60%" src="/content/images/2016/07/IMG_20160729_220358.jpg"></p>
<p>再将另一头接到树莓派上.注意树莓派的40个针脚对应的功能不是完全一样的.上一张B+版的图.</p>
<p><img width="60%" src="/content/images/2016/07/7d68bca4165c73a0.jpg"></p>
<p>我这里将IN1-4接到GPIO.22-25上 ENA和ENB接到GPIO26-29上<br><br>还有之前的5V和GND两根线接到5V和0V两个口上</p>
<p><img width="60%" src="/content/images/2016/07/IMG_20160729_220438.jpg"><br><img width="60%" src="/content/images/2016/07/IMG_20160729_220423.jpg"><br>再将摄像头插上后就算完全接好了.</p>
<p>接下来你需要给你的树莓派装上个系统.我这里装的是NOOBS.<a href="https://www.raspberrypi.org/downloads/noobs/" target="_blank" rel="external">下载链接</a>.建议下离线版…下载完后解压到内存卡里插进树莓派然后通电…接下来就是傻瓜式操作了.</p>
<p>====================================</p>
<p>进入桌面之后呢…先用你的无线网卡连上WIFI.然后打开命令行…我不喜欢在 Linux里面用图形界面…感觉怪怪的…<br><br>1.更新软件源<br>2.下载控制GPIO的python库<br>3.安装GPIO库<br>4.安装flask库<br>5…….</p>
<p>以上几步待我想起些什么的时候再补充.因为我系统里已经完成以上步骤了…</p>
<p>然后我说明一下如何通过 python 先让小车动起来…<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</div><div class="line">GPIO.setmode(GPIO.BOARD)</div><div class="line">GPIO.setup(<span class="number">32</span>, GPIO.OUT)</div><div class="line">GPIO.setup(<span class="number">36</span>, GPIO.OUT)</div><div class="line">GPIO.setup(<span class="number">38</span>, GPIO.OUT)</div><div class="line">GPIO.setup(<span class="number">40</span>, GPIO.OUT)</div><div class="line">GPIO.output(<span class="number">32</span>, GPIO.HIGH)</div><div class="line">GPIO.output(<span class="number">36</span>, GPIO.HIGH)</div><div class="line">GPIO.output(<span class="number">38</span>, GPIO.HIGH)</div><div class="line">GPIO.output(<span class="number">40</span>, GPIO.HIGH)</div></pre></td></tr></table></figure></p>
<p>这些代码的意思很简单.就是将32 36 38 40这四个针脚变为输出的高电位.要注意的是.这里的编号是使用树莓派上1-40这样的编号.也就是32对应的是 GPIO.29。注意参考上面那张树莓派针脚图.</p>
<p>这样做的目的很简单.就是通过将ENA和ENB设置为高电位后使电机工作.这时候有可能有电机已经开始转起来了.<br><br>但不要着急.还需要改变33 35 37 39这四个针脚的高低电位来使电机按自己的意愿工作起来.这里33 35 37 39就是通过控制IN1-4来调整OUT1-4的电流的.</p>
<p><img width="60%" src="/content/images/2016/07/8B1B5E54-475E-406E-BE00-45BFC6D5C8EA.png"></p>
<p>这里你就可以愉快的控制电机了…接下来是是摄像头和 APP 控制.这里我就不讲解了.直接在最后会上github 地址.</p>
<p>====================================</p>
<p>我们现在补充一些PWM调速的姿势.<br><br>现在小车是能按着我们我要求前进后退旋转了.可是他不能变速.所以ENA和ENB的用处就体现出来了.</p>
<p>这里我就只简单的举一个例子.大家举一反三…ENA和ENB在都是高电位的时候是小车工作.那么如果ENA和ENB每1毫秒变换一次电位.就能达到半速的效果…具体实现就是通过一个死循环.将32 36 38 40设为高电位后休眠1毫秒后设为低电位.在休眠1毫秒.如此循环…</p>
<p>=====================================</p>
<p>啊.就说这么多.上 <a href="https://github.com/BeginLjm/Raspberry-PI-telecar" target="_blank" rel="external">github地址</a></p>
<p>‘,’</p><p><img src="content/images/2016/07/Screenshot_2016-07-22-19-16-26-543_com-lu-che.jpg" style="float:left" width="30%"><img src="content/images/2016/07/6AC706DD27F6C6B063DF0D6EBE5D5FC3.jpg" width="30%/"></p><p></p>
<p>先上一波成果图</p>

<p>然后就是所需要的物品</p>

<p><img width="60%" src="/content/images/2016/07/IMG_20160729_212509.jpg"></p>

<p>包括树莓派（我这里是2代B+版）<br><br>L298N电机驱动板 <br><br>小车底座轮胎电机等…<br><br>树莓派摄像头<br><br>USB 无线网卡<br> <br><br>一把杜邦线（公对公 公对母 母对母）<br></p>

<p>因为我这里用的是移动电源为L298N供电.所以我还准备了一跟USB线。</p>

<p>然后是组装小车.底座方面没什么好说的.注意的是电机用公对公的杜邦线连.</p>

<p>连好后是这样的…</p>

<p><img width="60%" src="/content/images/2016/07/IMG_20160729_215024.jpg"> <br><br>然后是接线<br><br>电机上接出来的八根线将左边两个电机的接到OUT1和OUT2上.右边两个电机的接 OUT3和OUT4注意 OUT1和OUT2是电流的正负.注意别把一个电机的两根线都接到同一个OUT口了.<br></p>

<p>再取两根公对公的线接12V和GND用于电机供电在取两根公对母线接5V和GND 口用于逻辑芯片供电.</p>

<p>接好后如图</p>

<p><img width="60%" src="/content/images/2016/07/IMG_20160729_215306.jpg"></p>

<p>将接12V和GND的线与USB线连接.</p>

<p>像这样.用于连接移动电源供电</p>

<p><img width="60%" src="/content/images/2016/07/IMG_20160729_220621.jpg"></p>

<p>然后再取八根母对母的线连接ENA、ENB和IN1-4<br><img width="60%" src="/content/images/2016/07/IMG_20160729_220358.jpg"></p>

<p>再将另一头接到树莓派上.注意树莓派的40个针脚对应的功能不是完全一样的.上一张B+版的图.</p>

<p><img width="60%" src="/content/images/2016/07/7d68bca4165c73a0.jpg"></p>

<p>我这里将IN1-4接到GPIO.22-25上 ENA和ENB接到GPIO26-29上<br><br>还有之前的5V和GND两根线接到5V和0V两个口上</p>

<p><img width="60%" src="/content/images/2016/07/IMG_20160729_220438.jpg"> <br><br><img width="60%" src="/content/images/2016/07/IMG_20160729_220423.jpg"> <br><br>再将摄像头插上后就算完全接好了.</p>

<p>接下来你需要给你的树莓派装上个系统.我这里装的是NOOBS.<a href="https://www.raspberrypi.org/downloads/noobs/" target="_blank" rel="external">下载链接</a>.建议下离线版…下载完后解压到内存卡里插进树莓派然后通电…接下来就是傻瓜式操作了.</p>

<p>====================================</p>

<p>进入桌面之后呢…先用你的无线网卡连上WIFI.然后打开命令行…我不喜欢在 Linux里面用图形界面…感觉怪怪的…<br><br>1.更新软件源 <br><br>2.下载控制GPIO的python库 <br><br>3.安装GPIO库 <br><br>4.安装flask库 <br><br>5…….</p>

<p>以上几步待我想起些什么的时候再补充.因为我系统里已经完成以上步骤了…</p>

<p>然后我说明一下如何通过 python 先让小车动起来…</p>

<pre><code class="language-python">    import RPi.GPIO as GPIO
    GPIO.setmode(GPIO.BOARD)
    GPIO.setup(32, GPIO.OUT)
    GPIO.setup(36, GPIO.OUT)
    GPIO.setup(38, GPIO.OUT)
    GPIO.setup(40, GPIO.OUT)
    GPIO.output(32, GPIO.HIGH)
    GPIO.output(36, GPIO.HIGH)
    GPIO.output(38, GPIO.HIGH)
    GPIO.output(40, GPIO.HIGH)
</code></pre>

<p>这些代码的意思很简单.就是将32 36 38 40这四个针脚变为输出的高电位.要注意的是.这里的编号是使用树莓派上1-40这样的编号.也就是32对应的是 GPIO.29。注意参考上面那张树莓派针脚图.</p>

<p>这样做的目的很简单.就是通过将ENA和ENB设置为高电位后使电机工作.这时候有可能有电机已经开始转起来了.<br><br>但不要着急.还需要改变33 35 37 39这四个针脚的高低电位来使电机按自己的意愿工作起来.这里33 35 37 39就是通过控制IN1-4来调整OUT1-4的电流的.</p>

<p><img width="60%" src="/content/images/2016/07/8B1B5E54-475E-406E-BE00-45BFC6D5C8EA.png"></p>

<p>这里你就可以愉快的控制电机了…接下来是是摄像头和 APP 控制.这里我就不讲解了.直接在最后会上github 地址.</p>

<p>====================================</p>

<p>我们现在补充一些PWM调速的姿势.<br><br>现在小车是能按着我们我要求前进后退旋转了.可是他不能变速.所以ENA和ENB的用处就体现出来了.</p>

<p>这里我就只简单的举一个例子.大家举一反三…ENA和ENB在都是高电位的时候是小车工作.那么如果ENA和ENB每1毫秒变换一次电位.就能达到半速的效果…具体实现就是通过一个死循环.将32 36 38 40设为高电位后休眠1毫秒后设为低电位.在休眠1毫秒.如此循环…</p>

<p>=====================================</p>

<p>啊.就说这么多.上 <a href="https://github.com/BeginLjm/Raspberry-PI-telecar" target="_blank" rel="external">github地址</a></p>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/07/29/利用树莓派制作一个实时监控的遥控小车/" data-id="cirt8jj4b000f5ceo5obgz8td" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/树莓派/">树莓派</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-TabLayout（切换卡）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/05/02/TabLayout（切换卡）/" class="article-date">
  <time datetime="2016-05-01T23:45:19.000Z" itemprop="datePublished">2016-05-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/05/02/TabLayout（切换卡）/">TabLayout（切换卡）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先在 AS 中引入Material Design Support 包<br><img src="content/images/2016/05/80E8BDCD-05DD-4518-8C87-55FB9869864F.png" alt=""><br>在布局文件中使用 TabLayout<br><img src="content/images/2016/05/7C73175B-D312-4E83-8DC5-D3A06D808C96.png" alt=""><br>JAVA 文件中获取控件<br><img src="content/images/2016/05/3B8AD5F0-F3FE-423C-A2BF-62DE2F3DB950.png" alt=""><br>设置适配器.绑定视图<br><img src="content/images/2016/05/6DBD1FCB-0A2D-42A5-8B18-CD738FF016AE.png" alt=""><br>适配器<br><img src="content/images/2016/05/963C75EF-72AA-4BCB-AA8D-68951C53BA12.png" alt=""><br>vpMain 是绑定的视图.<br>创建视图<br><img src="content/images/2016/05/4E5F4172-70D8-4BF5-975D-979C6083C40F.png" alt=""><br>为 vpMain 设置同一个适配器并添加监听方法.具体 ViewPager 使用可以参考<br><a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/view/ViewPager.html" target="_blank" rel="external">http://developer.android.com/intl/zh-cn/reference/android/support/v4/view/ViewPager.html</a><br><img src="content/images/2016/05/B1DC056B-99C7-4979-90C7-DC4CE14EE959.png" alt="">‘,’</p><p>首先在 AS 中引入Material Design Support 包<br><img src="content/images/2016/05/80E8BDCD-05DD-4518-8C87-55FB9869864F.png" alt=""><br>在布局文件中使用 TabLayout<br><img src="content/images/2016/05/7C73175B-D312-4E83-8DC5-D3A06D808C96.png" alt=""><br>JAVA 文件中获取控件 <br><br><img src="content/images/2016/05/3B8AD5F0-F3FE-423C-A2BF-62DE2F3DB950.png" alt=""><br>设置适配器.绑定视图<br><img src="content/images/2016/05/6DBD1FCB-0A2D-42A5-8B18-CD738FF016AE.png" alt=""><br>适配器<br><img src="content/images/2016/05/963C75EF-72AA-4BCB-AA8D-68951C53BA12.png" alt=""><br>vpMain 是绑定的视图. <br><br>创建视图<br><img src="content/images/2016/05/4E5F4172-70D8-4BF5-975D-979C6083C40F.png" alt=""><br>为 vpMain 设置同一个适配器并添加监听方法.具体 ViewPager 使用可以参考<br><a href="http://developer.android.com/intl/zh-cn/reference/android/support/v4/view/ViewPager.html" target="_blank" rel="external">http://developer.android.com/intl/zh-cn/reference/android/support/v4/view/ViewPager.html</a> <br><br><img src="content/images/2016/05/B1DC056B-99C7-4979-90C7-DC4CE14EE959.png" alt=""></p><p></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/05/02/TabLayout（切换卡）/" data-id="cirt8jj46000a5ceoc8cib8qx" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/">Android</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/TabLayout/">TabLayout</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-DrawerLayout（侧滑菜单）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/05/02/DrawerLayout（侧滑菜单）/" class="article-date">
  <time datetime="2016-05-01T23:41:18.000Z" itemprop="datePublished">2016-05-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/05/02/DrawerLayout（侧滑菜单）/">Idea 通过 Maven 配置 Spring MVC+Hibernate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先在 AS 中引入Material Design Support 包<br><img src="content/images/2016/05/56086CA3-627A-452F-823A-98F5EEC6C552.png" alt=""><br>在布局文件中使用 DrawerLayout<br><img src="content/images/2016/05/DC32A29A-428C-4982-8023-3FE41EE453EF.png" alt=""><br>其中 FrameLayout 是界面视图 RelativeLayout 是侧滑视图 其中的 include 是侧滑菜单布局</p>
<p>在 JAVA 文件中获取侧滑菜单控件及布局<br><img src="content/images/2016/05/25F8BFE3-63FB-4A17-9C28-066E0AC21C1F.png" alt=""><br>关闭侧滑菜单<br><img src="content/images/2016/05/49A28A26-6550-4A80-B307-61E230A55BE5.png" alt=""><br>打开侧滑菜单<br><img src="content/images/2016/05/11D2F621-8D8E-4E80-903F-272F31FC47A5.png" alt="">‘,’</p><p>首先在 AS 中引入Material Design Support 包<br><img src="content/images/2016/05/56086CA3-627A-452F-823A-98F5EEC6C552.png" alt=""><br>在布局文件中使用 DrawerLayout<br><img src="content/images/2016/05/DC32A29A-428C-4982-8023-3FE41EE453EF.png" alt=""><br>其中 FrameLayout 是界面视图 RelativeLayout 是侧滑视图 其中的 include 是侧滑菜单布局</p><p></p>
<p>在 JAVA 文件中获取侧滑菜单控件及布局<br><img src="content/images/2016/05/25F8BFE3-63FB-4A17-9C28-066E0AC21C1F.png" alt=""><br>关闭侧滑菜单<br><img src="content/images/2016/05/49A28A26-6550-4A80-B307-61E230A55BE5.png" alt=""><br>打开侧滑菜单<br><img src="content/images/2016/05/11D2F621-8D8E-4E80-903F-272F31FC47A5.png" alt=""></p>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/05/02/DrawerLayout（侧滑菜单）/" data-id="cirt8jj49000d5ceoxmh3n1lc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Idea 通过 Maven 配置 Spring MVC+Hibernate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/04/24/Idea 通过 Maven 配置 Spring MVC+Hibernate/" class="article-date">
  <time datetime="2016-04-24T07:46:26.000Z" itemprop="datePublished">2016-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/04/24/Idea 通过 Maven 配置 Spring MVC+Hibernate/">Idea 通过 Maven 配置 Spring MVC+Hibernate</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#####1.新建项目<br>选择 Maven<br><br>勾选上 Create from archetype<br><br>选择 org.apache.maven.archetypes:maven-archetype-webapp<br></p>
<p><img src="content/images/2016/04/-----2016-04-24-15-49-09.png" alt=""></p>
<p>next<br></p>
<p>填写 GroupId 和 ArifactId<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">GroupID是项目组织唯一的标识符，实际对应JAVA的包的结构，是main目录里java的目录结构。</div><div class="line">ArtifactID就是项目的唯一的标识符，实际对应项目的名称，就是项目根目录的名称。</div><div class="line">一般GroupID就是填com.leafive.test这样子</div></pre></td></tr></table></figure></p>
<p><img src="content/images/2016/04/-----2016-04-24-16-00-31.png" alt=""></p>
<p>接下来就是傻瓜式的下一步.<br><br>进入编辑器后等待编辑器自动构建完成项目后打开==pom.xml==文件.将其修改为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line">    &lt;properties&gt;</div><div class="line">        &lt;spring.version&gt;4.2.5.RELEASE&lt;/spring.version&gt;</div><div class="line">        &lt;spring-data.version&gt;1.10.1.RELEASE&lt;/spring-data.version&gt;</div><div class="line">    &lt;/properties&gt;</div><div class="line">    &lt;dependencies&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;junit&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;junit&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;3.8.1&lt;/version&gt;</div><div class="line">            &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;2.5&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;2.1&lt;/version&gt;</div><div class="line">            &lt;scope&gt;provided&lt;/scope&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;</div><div class="line">            &lt;scope&gt;test&lt;/scope&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;jstl&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;jstl&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;1.2&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;$&#123;spring-data.version&#125;&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.hibernate.javax.persistence&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;hibernate-jpa-2.0-api&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;1.0.0.Final&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;3.6.10.Final&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;mysql&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;5.1.34&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.json&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;json&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;20080701&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">        &lt;dependency&gt;</div><div class="line">            &lt;groupId&gt;org.apache.struts&lt;/groupId&gt;</div><div class="line">            &lt;artifactId&gt;struts2-core&lt;/artifactId&gt;</div><div class="line">            &lt;version&gt;2.3.28.1&lt;/version&gt;</div><div class="line">        &lt;/dependency&gt;</div><div class="line">    &lt;/dependencies&gt;</div><div class="line">```</div><div class="line">等待编译器自动完成下载和导入后修改 ==web.xml== 文件</div></pre></td></tr></table></figure></p>
<p><web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" version="3.1"><br>  <display-name>Archetype Created Web Application</display-name><br>    <servlet><br>        <servlet-name>mvc-dispatcher</servlet-name><br>        <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class><br>        <load-on-startup>1</load-on-startup><br>    </servlet></web-app></p>
<pre><code>&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
&lt;filter&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;encoding&lt;/param-name&gt;
        &lt;param-value&gt;UTF-8&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
        &lt;param-value&gt;true&lt;/param-value&gt;
    &lt;/init-param&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
    &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre><p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">完成后进入项目设计菜单新建一个文件夹</div><div class="line">![](content/images/2016/05/-----2016-05-01-13-00-56.png)</div><div class="line">之后再将其设置为 Sources 文件夹</div><div class="line">![](content/images/2016/05/-----2016-05-01-13-02-11.png)</div><div class="line">在 java 文件夹中下创建如下四个包</div><div class="line">![](content/images/2016/05/-----2016-05-01-15-54-17.png)</div><div class="line">然后在 WEB-INF 目录下创建 mvc-dispatcher-servlet.xml 文件</div><div class="line">内容如下</div><div class="line">`</div></pre></td></tr></table></figure></p>
<p>&lt;?xml version=”1.0” encoding=”UTF-8”?&gt;</p>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc" xsi:schemalocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd">

<pre><code>&lt;!--指明 controller 所在包，并扫描其中的注解--&gt;
&lt;context:component-scan base-package=&quot;com.spring.controller&quot;/&gt;

&lt;!-- 静态资源(js、image等)的访问 --&gt;
&lt;mvc:default-servlet-handler/&gt;

&lt;!-- 开启注解 --&gt;
&lt;mvc:annotation-driven/&gt;

&lt;!--ViewResolver 视图解析器--&gt;
&lt;!--用于支持Servlet、JSP视图解析--&gt;
&lt;bean id=&quot;jspViewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
    &lt;property name=&quot;viewClass&quot; value=&quot;org.springframework.web.servlet.view.JstlView&quot;/&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;/&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;
&lt;/bean&gt;
</code></pre><p></p></beans><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">在 Controller 包中创建 MainController.java 文件</div><div class="line">内容如下</div><div class="line">`</div></pre></td></tr></table></figure><p></p>
<p>@Controller<br>public class MainController {</p>
<pre><code>@RequestMapping(value = &quot;/&quot;, method = RequestMethod.GET)
public String index() {
    return &quot;index&quot;;
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">然后在 WEB-INF 目录下创建 pages 目录.在该目录中创建 index.jsp 文件</div><div class="line">内容如下</div><div class="line">`</div></pre></td></tr></table></figure></p>
<p>&lt;%@ page contentType=”text/html;charset=UTF-8” language=”java” %&gt;<br>&lt;!DOCTYPE html&gt;</p>
<p><html lang="zh-CN"></html></p>
<p><head><br>    <meta charset="utf-8"><br>    <meta http-equiv="X-UA-Compatible" content="IE=edge"><br>    <meta name="viewport" content="width=device-width, initial-scale=1"><br>    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --><br>    <title>SpringMVC Demo 首页</title></head></p>
<pre><code>&lt;!-- 新 Bootstrap 核心 CSS 文件 --&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css&quot;&gt;

&lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;
&lt;!-- WARNING: Respond.js doesn&apos;&apos;t work if you view the page via file:// --&gt;
&lt;!--[if lt IE 9]&gt;
&lt;script src=&quot;//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;//cdn.bootcss.com/respond.js/1.4.2/respond.min.js&quot;&gt;&lt;/script&gt;
&lt;![endif]--&gt;
</code></pre><p></p>
<p><body></body></p>
<h1>这里是SpringMVC Demo首页</h1>

<h3>出现此页面，说明配置成功。</h3>

<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">这时候 SpringMVC 的配置已经基本完成了.直接运行项目就可以看到</div><div class="line">![](content/images/2016/05/-----2016-05-01-21-59-02-1.png)</div><div class="line">然后先把 Spring 放一边.来配置一下Hibernate.&lt;br&gt;</div><div class="line">首先右键项目选择 Add Framework Support</div><div class="line">![](content/images/2016/05/-----2016-05-01-22-00-57.png)</div><div class="line">然后勾选上 JavaEE Persistence 后选择 Hibernate 点击 OK</div><div class="line">![](content/images/2016/05/-----2016-05-01-22-15-36.png)</div><div class="line">这时候已经导入了 Hibernate 的 jar 包.然后点击编辑器的左下角的 Persistence在 SpringMVC 上右键.选择By DataBase Schema</div><div class="line">![](content/images/2016/05/-----2016-05-01-15-59-21.png)</div><div class="line">点击 Choose Data Source 旁的... 之后点击+号选择 MySql </div><div class="line">![](content/images/2016/05/-----2016-05-01-16-00-34.png)</div><div class="line">填写完成后点击 OK</div><div class="line">![](content/images/2016/05/-----2016-05-01-16-01-25.png)</div><div class="line">PS:数据库的创建我不介绍.直接上数据库的结构图.</div><div class="line">user 表</div><div class="line">![](content/images/2016/05/-----2016-05-01-16-03-03.png)</div><div class="line">blog 表</div><div class="line">![](content/images/2016/05/-----2016-05-01-16-02-53.png)</div><div class="line">之后返回到上一级页面.然后选择包.点击刷新.选上表及内容后点击 OK</div><div class="line">![](content/images/2016/05/-----2016-05-01-22-18-11.png)</div><div class="line">修改一下 persistence.xml 文件</div><div class="line">如下</div><div class="line">`</div></pre></td></tr></table></figure>

<?xml version="1.0" encoding="UTF-8"?>
<persistence xmlns="http://java.sun.com/xml/ns/persistence" version="2.0">

    <persistence-unit name="defaultPersistenceUnit" transaction-type="RESOURCE_LOCAL">
        <provider>org.hibernate.ejb.HibernatePersistence</provider>
        <properties>
            <!-- 使用MySQL方言 -->
            <property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect">
            <!-- 数据库连接的URL地址 -->
            <property name="hibernate.connection.url" value="jdbc:mysql://localhost:3306/springdemo">
            <!-- 数据库连接的驱动 -->
            <property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver">
            <!-- 数据库连接的用户名 -->
            <property name="hibernate.connection.username" value="root">
            <!-- 数据库连接的密码 -->
            <property name="hibernate.connection.password" value="Lu935226769">
            <!-- 显示SQL语句 -->
            <property name="hibernate.show_sql" value="true">

            <property name="hibernate.connection.useUnicode" value="true">
            <property name="hibernate.connection.characterEncoding" value="UTF-8">

            <!-- 在显示SQL语句时格式化语句 -->
            <property name="hibernate.format_sql" value="true">
            <property name="hibernate.use_sql_comments" value="false">
            <!-- 自动输出schema创建DDL语句 -->
            <property name="hibernate.hbm2ddl.auto" value="update">

            <!-- 数据库连接超时后自动重连 -->
            <property name="hibernate.connection.autoReconnect" value="true">
            <property name="connection.autoReconnectForPools" value="true">
            <property name="connection.is-connection-validation-required" value="true">
        </property></property></property></property></property></property></property></property></property></property></property></property></property></property></properties>
    </persistence-unit>
</persistence>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">这时候就已经完成了通过 Hibernate 导入数据库的操作&lt;br&gt;</div><div class="line">但需要为 model 创建 repository &lt;br&gt;</div><div class="line">内容如下</div><div class="line">![](content/images/2016/05/-----2016-05-01-16-12-20.png)</div><div class="line">然后需要修改 mvc-dispatcher-servlet.xml 文件.加入以下内容...</div><div class="line">`</div></pre></td></tr></table></figure>

       <!-- 表示JPA Repository所在的包 -->
       <jpa:repositories base-package="com.springmvc.repository">

       <!-- 链接到persistence.xml -->
       <bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean">
              <property name="persistenceUnitName" value="defaultPersistenceUnit">
       </property></bean>

       <!-- 事务管理 -->
       <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
              <property name="entityManagerFactory" ref="entityManagerFactory">
       </property></bean>

       <bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean">
              <property name="annotatedClasses">
                     <list>
                            <value>com.springmvc.model.Blog</value>
                            <value>com.springmvc.model.User</value>
                     </list>
              </property>
              <property name="hibernateProperties">
                     <props>
                            <prop key="hibernate.connection.url">jdbc:mysql://localhost:3306/SpringDemo</prop>
                            <prop key="hibernate.connection.driver_class">com.mysql.jdbc.Driver</prop>
                     </props>
              </property>
       </bean>

       <!-- 开启事务管理注解 -->
       <tx:annotation-driven transaction-manager="transactionManager">
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">再在 MainController 文件中加入以下内容</div><div class="line">`</div></pre></td></tr></table></figure>

    @Autowired
    UserRepository userRepository;

    @RequestMapping(value = "/admin/users", method = RequestMethod.GET)
    public String getUsers(ModelMap modelMap) {
        List<user> list = userRepository.findAll();
        modelMap.addAttribute("userList", list);
        return "admin/users";
    }
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">在 pages 下创建目录 admin 中创建 users.jsp 文件</div><div class="line">内容如下</div><div class="line">`</div></pre></td></tr></table></figure>

<%@ page="" contenttype="text/html;charset=UTF-8" language="java" %="">
<%@ taglib="" prefix="c" uri="http://java.sun.com/jsp/jstl/core" %="">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
  <title>SpringMVC 用户管理</title>

  <!-- 新 Bootstrap 核心 CSS 文件 -->
  <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn''t work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<div class="container">
  <h1>SpringMVC 博客系统-用户管理</h1>
  <hr>

  <h3>所有用户 <a href="/admin/users/add" type="button" class="btn btn-primary btn-sm">添加</a></h3>

  <!-- 如果用户列表为空 -->
  <c:if test="${empty userList}">
    <div class="alert alert-warning" role="alert">
      <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span>User表为空，请<a href="/admin/users/add" type="button" class="btn btn-primary btn-sm">添加</a>
    </div>
  </c:if>

  <!-- 如果用户列表非空 -->
  <c:if test="${!empty userList}">
    <table class="table table-bordered table-striped">
      <tr>
        <th>ID</th>
        <th>昵称</th>
        <th>姓名</th>
        <th>密码</th>
        <th>操作</th>
      </tr>

      <c:foreach items="${userList}" var="user">
        <tr>
          <td>${user.id}</td>
          <td>${user.nickname}</td>
          <td>${user.firstName} ${user.lastName}</td>
          <td>${user.password}</td>
          <td>
            <a href="/admin/users/show/${user.id}" type="button" class="btn btn-sm btn-success">详情</a>
            <a href="/admin/users/update/${user.id}" type="button" class="btn btn-sm btn-warning">修改</a>
            <a href="/admin/users/delete/${user.id}" type="button" class="btn btn-sm btn-danger">删除</a>
          </td>
        </tr>
      </c:foreach>
    </table>
  </c:if>
</div>

<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<p><script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script><br></p></body><br></html><br>```<br>这时候运行项目访问<a href="http://localhost:8080/admin/users" target="_blank" rel="external">http://localhost:8080/admin/users</a> 就可以看到<br><img src="content/images/2016/05/-----2016-05-01-23-42-09.png" alt=""><br>‘,’<h5 id="1">1.新建项目</h5><p></p>
<p>选择 Maven<br><br>勾选上 Create from archetype<br><br>选择 org.apache.maven.archetypes:maven-archetype-webapp<br></p>

<p><img src="content/images/2016/04/-----2016-04-24-15-49-09.png" alt=""></p>

<p>next<br></p>

<p>填写 GroupId 和 ArifactId</p>

<pre><code>GroupID是项目组织唯一的标识符，实际对应JAVA的包的结构，是main目录里java的目录结构。  
ArtifactID就是项目的唯一的标识符，实际对应项目的名称，就是项目根目录的名称。  
一般GroupID就是填com.leafive.test这样子
</code></pre>

<p><img src="content/images/2016/04/-----2016-04-24-16-00-31.png" alt=""></p>

<p>接下来就是傻瓜式的下一步.<br><br>进入编辑器后等待编辑器自动构建完成项目后打开<mark>pom.xml</mark>文件.将其修改为</p>

<pre><code class="language-`">    &lt;properties&gt;
        &lt;spring.version&gt;4.2.5.RELEASE&lt;/spring.version&gt;
        &lt;spring-data.version&gt;1.10.1.RELEASE&lt;/spring-data.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;junit&lt;/groupId&gt;
            &lt;artifactId&gt;junit&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
            &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
            &lt;version&gt;2.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
            &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
            &lt;version&gt;2.1&lt;/version&gt;
            &lt;scope&gt;provided&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
            &lt;version&gt;${spring.version}&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;jstl&lt;/groupId&gt;
            &lt;artifactId&gt;jstl&lt;/artifactId&gt;
            &lt;version&gt;1.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;
            &lt;artifactId&gt;spring-data-jpa&lt;/artifactId&gt;
            &lt;version&gt;${spring-data.version}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate.javax.persistence&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-jpa-2.0-api&lt;/artifactId&gt;
            &lt;version&gt;1.0.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-entitymanager&lt;/artifactId&gt;
            &lt;version&gt;3.6.10.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;5.1.34&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.json&lt;/groupId&gt;
            &lt;artifactId&gt;json&lt;/artifactId&gt;
            &lt;version&gt;20080701&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.struts&lt;/groupId&gt;
            &lt;artifactId&gt;struts2-core&lt;/artifactId&gt;
            &lt;version&gt;2.3.28.1&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
</code></pre>

<p>等待编译器自动完成下载和导入后修改 <mark>web.xml</mark> 文件</p>

<pre><code class="language-`">&lt;web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee"  
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"
         version="3.1"&gt;
  &lt;display-name&gt;Archetype Created Web Application&lt;/display-name&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;mvc-dispatcher&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;encoding&lt;/param-name&gt;
            &lt;param-value&gt;UTF-8&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;forceEncoding&lt;/param-name&gt;
            &lt;param-value&gt;true&lt;/param-value&gt;
        &lt;/init-param&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;
&lt;/web-app&gt;  
</code></pre>

<p>完成后进入项目设计菜单新建一个文件夹<br><img src="content/images/2016/05/-----2016-05-01-13-00-56.png" alt=""><br>之后再将其设置为 Sources 文件夹<br><img src="content/images/2016/05/-----2016-05-01-13-02-11.png" alt=""><br>在 java 文件夹中下创建如下四个包<br><img src="content/images/2016/05/-----2016-05-01-15-54-17.png" alt=""><br>然后在 WEB-INF 目录下创建 mvc-dispatcher-servlet.xml 文件<br>内容如下</p>

<pre><code class="language-`">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;beans xmlns="http://www.springframework.org/schema/beans"  
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"&gt;

    &lt;!--指明 controller 所在包，并扫描其中的注解--&gt;
    &lt;context:component-scan base-package="com.spring.controller"/&gt;

    &lt;!-- 静态资源(js、image等)的访问 --&gt;
    &lt;mvc:default-servlet-handler/&gt;

    &lt;!-- 开启注解 --&gt;
    &lt;mvc:annotation-driven/&gt;

    &lt;!--ViewResolver 视图解析器--&gt;
    &lt;!--用于支持Servlet、JSP视图解析--&gt;
    &lt;bean id="jspViewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
        &lt;property name="viewClass" value="org.springframework.web.servlet.view.JstlView"/&gt;
        &lt;property name="prefix" value="/WEB-INF/pages/"/&gt;
        &lt;property name="suffix" value=".jsp"/&gt;
    &lt;/bean&gt;
&lt;/beans&gt;  
</code></pre>

<p>在 Controller 包中创建 MainController.java 文件<br>内容如下</p>

<pre><code class="language-`">@Controller
public class MainController {

    @RequestMapping(value = "/", method = RequestMethod.GET)
    public String index() {
        return "index";
    }
}
</code></pre>

<p>然后在 WEB-INF 目录下创建 pages 目录.在该目录中创建 index.jsp 文件<br>内容如下</p>

<pre><code class="language-`">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;  
&lt;!DOCTYPE html&gt;  
&lt;html lang="zh-CN"&gt;  
&lt;head&gt;  
    &lt;meta charset="utf-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
    &lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;
    &lt;title&gt;SpringMVC Demo 首页&lt;/title&gt;

    &lt;!-- 新 Bootstrap 核心 CSS 文件 --&gt;
    &lt;link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;

    &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;
    &lt;!-- WARNING: Respond.js doesn''t work if you view the page via file:// --&gt;
    &lt;!--[if lt IE 9]&gt;
    &lt;script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"&gt;&lt;/script&gt;
    &lt;script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt;
    &lt;![endif]--&gt;
&lt;/head&gt;  
&lt;body&gt;  
&lt;h1&gt;这里是SpringMVC Demo首页&lt;/h1&gt;

&lt;h3&gt;出现此页面，说明配置成功。&lt;/h3&gt;

&lt;!-- jQuery文件。务必在bootstrap.min.js 之前引入 --&gt;  
&lt;script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt;

&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;  
&lt;script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"&gt;&lt;/script&gt;  
&lt;/body&gt;  
&lt;/html&gt;  
</code></pre>

<p>这时候 SpringMVC 的配置已经基本完成了.直接运行项目就可以看到<br><img src="content/images/2016/05/-----2016-05-01-21-59-02-1.png" alt=""><br>然后先把 Spring 放一边.来配置一下Hibernate.<br><br>首先右键项目选择 Add Framework Support<br><img src="content/images/2016/05/-----2016-05-01-22-00-57.png" alt=""><br>然后勾选上 JavaEE Persistence 后选择 Hibernate 点击 OK<br><img src="content/images/2016/05/-----2016-05-01-22-15-36.png" alt=""><br>这时候已经导入了 Hibernate 的 jar 包.然后点击编辑器的左下角的 Persistence在 SpringMVC 上右键.选择By DataBase Schema<br><img src="content/images/2016/05/-----2016-05-01-15-59-21.png" alt=""><br>点击 Choose Data Source 旁的… 之后点击+号选择 MySql<br><img src="content/images/2016/05/-----2016-05-01-16-00-34.png" alt=""><br>填写完成后点击 OK<br><img src="content/images/2016/05/-----2016-05-01-16-01-25.png" alt=""><br>PS:数据库的创建我不介绍.直接上数据库的结构图. <br><br>user 表 <br><br><img src="content/images/2016/05/-----2016-05-01-16-03-03.png" alt=""><br>blog 表 <br><br><img src="content/images/2016/05/-----2016-05-01-16-02-53.png" alt=""><br>之后返回到上一级页面.然后选择包.点击刷新.选上表及内容后点击 OK<br><img src="content/images/2016/05/-----2016-05-01-22-18-11.png" alt=""><br>修改一下 persistence.xml 文件<br>如下</p>

<pre><code class="language-`">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  
&lt;persistence xmlns="http://java.sun.com/xml/ns/persistence" version="2.0"&gt;

    &lt;persistence-unit name="defaultPersistenceUnit"  transaction-type="RESOURCE_LOCAL"&gt;
        &lt;provider&gt;org.hibernate.ejb.HibernatePersistence&lt;/provider&gt;
        &lt;properties&gt;
            &lt;!-- 使用MySQL方言 --&gt;
            &lt;property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect"/&gt;
            &lt;!-- 数据库连接的URL地址 --&gt;
            &lt;property name="hibernate.connection.url"
                      value="jdbc:mysql://localhost:3306/springdemo"/&gt;
            &lt;!-- 数据库连接的驱动 --&gt;
            &lt;property name="hibernate.connection.driver_class" value="com.mysql.jdbc.Driver"/&gt;
            &lt;!-- 数据库连接的用户名 --&gt;
            &lt;property name="hibernate.connection.username" value="root"/&gt;
            &lt;!-- 数据库连接的密码 --&gt;
            &lt;property name="hibernate.connection.password" value="Lu935226769"/&gt;
            &lt;!-- 显示SQL语句 --&gt;
            &lt;property name="hibernate.show_sql" value="true"/&gt;

            &lt;property name="hibernate.connection.useUnicode" value="true"/&gt;
            &lt;property name="hibernate.connection.characterEncoding" value="UTF-8"/&gt;

            &lt;!-- 在显示SQL语句时格式化语句 --&gt;
            &lt;property name="hibernate.format_sql" value="true"/&gt;
            &lt;property name="hibernate.use_sql_comments" value="false"/&gt;
            &lt;!-- 自动输出schema创建DDL语句 --&gt;
            &lt;property name="hibernate.hbm2ddl.auto" value="update"/&gt;

            &lt;!-- 数据库连接超时后自动重连 --&gt;
            &lt;property name="hibernate.connection.autoReconnect" value="true"/&gt;
            &lt;property name="connection.autoReconnectForPools" value="true"/&gt;
            &lt;property name="connection.is-connection-validation-required" value="true"/&gt;
        &lt;/properties&gt;
    &lt;/persistence-unit&gt;
&lt;/persistence&gt;  
</code></pre>

<p>这时候就已经完成了通过 Hibernate 导入数据库的操作<br><br>但需要为 model 创建 repository <br><br>内容如下<br><img src="content/images/2016/05/-----2016-05-01-16-12-20.png" alt=""><br>然后需要修改 mvc-dispatcher-servlet.xml 文件.加入以下内容…</p>

<pre><code class="language-`">       &lt;!-- 表示JPA Repository所在的包 --&gt;
       &lt;jpa:repositories base-package="com.springmvc.repository"/&gt;

       &lt;!-- 链接到persistence.xml --&gt;
       &lt;bean id="entityManagerFactory" class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean"&gt;
              &lt;property name="persistenceUnitName" value="defaultPersistenceUnit"/&gt;
       &lt;/bean&gt;

       &lt;!-- 事务管理 --&gt;
       &lt;bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager"&gt;
              &lt;property name="entityManagerFactory" ref="entityManagerFactory"/&gt;
       &lt;/bean&gt;

       &lt;bean id="sessionFactory" class="org.springframework.orm.hibernate4.LocalSessionFactoryBean"&gt;
              &lt;property name="annotatedClasses"&gt;
                     &lt;list&gt;
                            &lt;value&gt;com.springmvc.model.Blog&lt;/value&gt;
                            &lt;value&gt;com.springmvc.model.User&lt;/value&gt;
                     &lt;/list&gt;
              &lt;/property&gt;
              &lt;property name="hibernateProperties"&gt;
                     &lt;props&gt;
                            &lt;prop key="hibernate.connection.url"&gt;jdbc:mysql://localhost:3306/SpringDemo&lt;/prop&gt;
                            &lt;prop key="hibernate.connection.driver_class"&gt;com.mysql.jdbc.Driver&lt;/prop&gt;
                     &lt;/props&gt;
              &lt;/property&gt;
       &lt;/bean&gt;

       &lt;!-- 开启事务管理注解 --&gt;
       &lt;tx:annotation-driven transaction-manager="transactionManager"/&gt;
</code></pre>

<p>再在 MainController 文件中加入以下内容</p>

<pre><code class="language-`">    @Autowired
    UserRepository userRepository;

    @RequestMapping(value = "/admin/users", method = RequestMethod.GET)
    public String getUsers(ModelMap modelMap) {
        List&lt;User&gt; list = userRepository.findAll();
        modelMap.addAttribute("userList", list);
        return "admin/users";
    }
</code></pre>

<p>在 pages 下创建目录 admin 中创建 users.jsp 文件<br>内容如下</p>

<pre><code class="language-`">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;  
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;  
&lt;!DOCTYPE html&gt;  
&lt;html lang="zh-CN"&gt;  
&lt;head&gt;  
  &lt;meta charset="utf-8"&gt;
  &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;
  &lt;!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ --&gt;
  &lt;title&gt;SpringMVC 用户管理&lt;/title&gt;

  &lt;!-- 新 Bootstrap 核心 CSS 文件 --&gt;
  &lt;link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css"&gt;

  &lt;!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries --&gt;
  &lt;!-- WARNING: Respond.js doesn''t work if you view the page via file:// --&gt;
  &lt;!--[if lt IE 9]&gt;
  &lt;script src="//cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"&gt;&lt;/script&gt;
  &lt;script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"&gt;&lt;/script&gt;
  &lt;![endif]--&gt;
&lt;/head&gt;  
&lt;body&gt;  
&lt;div class="container"&gt;  
  &lt;h1&gt;SpringMVC 博客系统-用户管理&lt;/h1&gt;
  &lt;hr/&gt;

  &lt;h3&gt;所有用户 &lt;a href="/admin/users/add" type="button" class="btn btn-primary btn-sm"&gt;添加&lt;/a&gt;&lt;/h3&gt;

  &lt;!-- 如果用户列表为空 --&gt;
  &lt;c:if test="${empty userList}"&gt;
    &lt;div class="alert alert-warning" role="alert"&gt;
      &lt;span class="glyphicon glyphicon-info-sign" aria-hidden="true"&gt;&lt;/span&gt;User表为空，请&lt;a href="/admin/users/add" type="button" class="btn btn-primary btn-sm"&gt;添加&lt;/a&gt;
    &lt;/div&gt;
  &lt;/c:if&gt;

  &lt;!-- 如果用户列表非空 --&gt;
  &lt;c:if test="${!empty userList}"&gt;
    &lt;table class="table table-bordered table-striped"&gt;
      &lt;tr&gt;
        &lt;th&gt;ID&lt;/th&gt;
        &lt;th&gt;昵称&lt;/th&gt;
        &lt;th&gt;姓名&lt;/th&gt;
        &lt;th&gt;密码&lt;/th&gt;
        &lt;th&gt;操作&lt;/th&gt;
      &lt;/tr&gt;

      &lt;c:forEach items="${userList}" var="user"&gt;
        &lt;tr&gt;
          &lt;td&gt;${user.id}&lt;/td&gt;
          &lt;td&gt;${user.nickname}&lt;/td&gt;
          &lt;td&gt;${user.firstName} ${user.lastName}&lt;/td&gt;
          &lt;td&gt;${user.password}&lt;/td&gt;
          &lt;td&gt;
            &lt;a href="/admin/users/show/${user.id}" type="button" class="btn btn-sm btn-success"&gt;详情&lt;/a&gt;
            &lt;a href="/admin/users/update/${user.id}" type="button" class="btn btn-sm btn-warning"&gt;修改&lt;/a&gt;
            &lt;a href="/admin/users/delete/${user.id}" type="button" class="btn btn-sm btn-danger"&gt;删除&lt;/a&gt;
          &lt;/td&gt;
        &lt;/tr&gt;
      &lt;/c:forEach&gt;
    &lt;/table&gt;
  &lt;/c:if&gt;
&lt;/div&gt;

&lt;!-- jQuery文件。务必在bootstrap.min.js 之前引入 --&gt;  
&lt;script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"&gt;&lt;/script&gt;

&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;  
&lt;script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"&gt;&lt;/script&gt;  
&lt;/body&gt;  
&lt;/html&gt;  
</code></pre>

<p>这时候运行项目访问<a href="http://localhost:8080/admin/users" target="_blank" rel="external">http://localhost:8080/admin/users</a> 就可以看到<br><img src="content/images/2016/05/-----2016-05-01-23-42-09.png" alt=""></p></%@></%@></user></tx:annotation-driven></jpa:repositories>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/04/24/Idea 通过 Maven 配置 Spring MVC+Hibernate/" data-id="cirt8jj4h000k5ceo5o5nqa9f" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Spring/">Spring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="listview-ListView ScrollView 不得不说的一些事" class="article article-type-listview" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/01/23/ListView ScrollView 不得不说的一些事/" class="article-date">
  <time datetime="2016-01-22T16:20:52.000Z" itemprop="datePublished">2016-01-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/01/23/ListView ScrollView 不得不说的一些事/">ListView ScrollView 不得不说的一些事</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>因为其实也不是第一次遇到这样的问题了.即便是第二次遇到这个问题.依然是让我头疼不已.<br>很多时候会遇到一些需求是需要在 ScrollView 中嵌套 ListView 的.对于这种情况我熟悉的有两种解决方案</p>
<h1 id="ScrollView-中嵌套-ListView"><a href="#ScrollView-中嵌套-ListView" class="headerlink" title="ScrollView 中嵌套 ListView"></a>ScrollView 中嵌套 ListView</h1><h2 id="1-将-ListView-之外的部分作为-ListView-中的一部分"><a href="#1-将-ListView-之外的部分作为-ListView-中的一部分" class="headerlink" title="1.将 ListView 之外的部分作为 ListView 中的一部分."></a>1.将 ListView 之外的部分作为 ListView 中的一部分.</h2><p>这个方法是在getView中对 position 进行判断并处理。<br>这个方法能满足几乎所有的情况，但是这样的话在 Adapter 中 getView 方法里的代码就过于复杂了。</p>
<h2 id="2-重写-ListView"><a href="#2-重写-ListView" class="headerlink" title="2.重写 ListView"></a>2.重写 ListView</h2><p>自定义 View 继承 ListView<br>重写onMeasure方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * 重写该方法，达到使ListView适应ScrollView的效果</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> expandSpec = MeasureSpec.makeMeasureSpec(Integer.MAX_VALUE &gt;&gt; <span class="number">2</span>, MeasureSpec.AT_MOST);</div><div class="line">    <span class="keyword">super</span>.onMeasure(widthMeasureSpec, expandSpec);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法我暂时发现了一个问题，就是在初次加载的时候会加载一次 ListView 中所有的 View，虽然通过在 Adapter 中使用 convertView 可以避免内存溢出,但是在 Count 数量很大的情况下会消耗较长时间。</p>
<p>更多方法可以<a href="http://bbs.anzhuo.cn/thread-982250-1-1.html" target="_blank" rel="external">点击这里</a>查看</p>
<h1 id="ScrollView-中嵌套-ViewPage"><a href="#ScrollView-中嵌套-ViewPage" class="headerlink" title="ScrollView 中嵌套 ViewPage"></a>ScrollView 中嵌套 ViewPage</h1><p>在 ScrollView 中嵌套 ViewPage 会出现点击事件无响应且无法滑动的情况。<br>这时候可以重写 ScrollView<br>自定义一个 View 继承ScrollView<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyScrollView</span> <span class="keyword">extends</span> <span class="title">ScrollView</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> canScroll;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> GestureDetector mGestureDetector;</div><div class="line">    View.OnTouchListener mGestureListener;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyScrollView</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        mGestureDetector = <span class="keyword">new</span> GestureDetector(<span class="keyword">new</span> YScrollDetector());</div><div class="line">        canScroll = <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onInterceptTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(ev.getAction() == MotionEvent.ACTION_UP)</div><div class="line">            canScroll = <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onInterceptTouchEvent(ev) &amp;&amp; mGestureDetector.onTouchEvent(ev);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">YScrollDetector</span> <span class="keyword">extends</span> <span class="title">SimpleOnGestureListener</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onScroll</span><span class="params">(MotionEvent e1, MotionEvent e2, <span class="keyword">float</span> distanceX, <span class="keyword">float</span> distanceY)</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(canScroll)</div><div class="line">                <span class="keyword">if</span> (Math.abs(distanceY) &gt;= Math.abs(distanceX))</div><div class="line">                    canScroll = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">else</span></div><div class="line">                    canScroll = <span class="keyword">false</span>;</div><div class="line">            <span class="keyword">return</span> canScroll;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/01/23/ListView ScrollView 不得不说的一些事/" data-id="cirt8jj4d000h5ceo9g87squv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/Android/">Android</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2016/01/21/hello-world/" class="article-date">
  <time datetime="2016-01-21T13:25:57.000Z" itemprop="datePublished">2016-01-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2016/01/21/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2016/01/21/hello-world/" data-id="cirt8jj4f000i5ceojdd3x1gz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2015年总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2015/12/31/2015年总结/" class="article-date">
  <time datetime="2015-12-31T15:17:11.000Z" itemprop="datePublished">2015-12-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2015/12/31/2015年总结/">2015年总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>首先，仔细回想了一下这一年，用一个词来形容的话就是荒废。<br>这一年，我开发了第一款属于自己独立开发的 APP，第一次对某公司现有 APP 进行了短期的更新与维护，第一次去学习 Android 开发以外其它的开发技术……<br>虽然这一年我有很多的第一次，但是真在的感觉到了自己的荒废。没有了最初学习的那种努力，开始无意义无目的的学习。没有了以前熬夜编码的精力，开始纠结自己的身体状况。<br>这一年做了很多，但是远没有我想像中收获的那么多，很多时候看到某某公司招聘要求是3年以上开发经验，但是我这一年下来并没有感觉我的提升有我想象中那么大。我不知道用这样的进度，两年后我的 Android 技能树能点到多少，因为我知道，越到后面，提升越难。<br>这一年，我仅仅只是在去年的基础上学会了 Android 中在我看来极小部分的知识<br>这一年，我仅仅是了解了 javaweb 开发的一些基本知识<br>这一年，我仅仅是学了很多 但会的不多<br>作为程序员，我这一年只做了这些。<br>作为一个学生，我只能说我的大学生活过去一半了，英语也还一直是挂，时间也越来越不够用了。<br>希望我明年能在 Android 开发方面再有突破，对 Linux 和 C 语言进行更系统的学习，开始涉及 Android 底层方面的开发，在 Android开发这条路上能越走越远。<br>希望我明年也能对自己好好的，少熬夜，少熬夜，少熬夜！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://beginljm.github.io/blog/2015/12/31/2015年总结/" data-id="cirt8jj3300005ceo4uqzpt9x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/blog/tags/扯淡/">扯淡</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/blog/page/2/">2</a><a class="extend next" rel="next" href="/blog/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/IPC/">IPC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/ImageIO/">ImageIO</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/JavaWeb/">JavaWeb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/PopupWindow/">PopupWindow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/Spring/">Spring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/TabLayout/">TabLayout</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/反射/">反射</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/扯淡/">扯淡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/树莓派/">树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/blog/tags/黑苹果/">黑苹果</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/blog/tags/Android/" style="font-size: 20px;">Android</a> <a href="/blog/tags/IPC/" style="font-size: 10px;">IPC</a> <a href="/blog/tags/ImageIO/" style="font-size: 10px;">ImageIO</a> <a href="/blog/tags/Java/" style="font-size: 16.67px;">Java</a> <a href="/blog/tags/JavaWeb/" style="font-size: 10px;">JavaWeb</a> <a href="/blog/tags/PopupWindow/" style="font-size: 10px;">PopupWindow</a> <a href="/blog/tags/Spring/" style="font-size: 13.33px;">Spring</a> <a href="/blog/tags/TabLayout/" style="font-size: 10px;">TabLayout</a> <a href="/blog/tags/反射/" style="font-size: 10px;">反射</a> <a href="/blog/tags/扯淡/" style="font-size: 10px;">扯淡</a> <a href="/blog/tags/树莓派/" style="font-size: 10px;">树莓派</a> <a href="/blog/tags/黑苹果/" style="font-size: 10px;">黑苹果</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/08/">August 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/blog/archives/2015/07/">July 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2016/08/13/Android 多进程 IPC/">Android 多进程通信 IPC</a>
          </li>
        
          <li>
            <a href="/blog/2016/08/04/Android动态加载/">Android动态加载</a>
          </li>
        
          <li>
            <a href="/blog/2016/08/04/转-详解Java中使用ImageIO类对图片进行压缩的方法/">转-详解Java中使用ImageIO类对图片进行压缩的方法</a>
          </li>
        
          <li>
            <a href="/blog/2016/07/29/利用树莓派制作一个实时监控的遥控小车/">利用树莓派制作一个实时监控的遥控小车</a>
          </li>
        
          <li>
            <a href="/blog/2016/05/02/TabLayout（切换卡）/">TabLayout（切换卡）</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">Home</a>
  
    <a href="/blog/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>

  </div>
</body>
</html>